#!/usr/bin/env python
# -*- coding: utf-8 -*-

import math
import argparse
import re

# Скрипт способен моделировать полёт низкоскоростных (Mach < 1) и низколетящих объектов.
# В соотвествии с законами механики и аэродинамики, в условиях земноподобной планеты.

# Примеры
# Полёт пегаса с автопилотом:
# python pegasus-flight-simulation.py Пегас
# Полёт пегаса с полезной нагрузкой:
# python pegasus-flight-simulation.py Пегас -w 300
# Поиск оптимальной (по дальности) скорости и угла атаки:
# python pegasus-flight-simulation.py -m Пегас
# python pegasus-flight-simulation.py -m Тяжёлый планёр
# Полёт пегаса с полезной нагрузкой в 300 килограмм, скоростью в 200 км/час и углом атаки в 15 градусов:
# python pegasus-flight-simulation.py -m Пегас -w 300 -s 200 -a 15

#-------------------------------------------------------------------------
# Известные баги:

# * Экранолёт не умеет пикировать. Потому что никто не умеет пикировать. f_gliding, lift_force < 0
# * Воздухозаборники должны сжимать воздух. Преобразование динамического давления в статическое.
    # * При этом скорость потока воздуха замедляется, нужно учесть это в f_jet_force.
# * С пикированием проблемы. Скорость падает, потому что площадь фронтальной проекции растёт.
# * Оптимальный угол атаки и скорость высчитывается тупым перебором, а можно парой формул.
# * А к тому же по -m вызывается старая, глупая модель, которая умеет только в прямолинейный полёт.

#-------------------------------------------------------------------------
# Общие переменные:

# Пока что константы:
# Температура в градусах цельсия:
AIR_TEMPERATURE = 20
# Плотность воздуха в кг/м² (нужно поставить зависимость от температуры и высоты)
AIR_DENSITY = 1.2
# Удельная теплоёмкость воздуха кДж/кг*К (зависит от температуры и давления)
AIR_HEAT_CAPACITY = 1.006
# Показатель адиабаты (зависит от температуры, пока что при 20°C)
AIR_HEAT_CAPACITY_RATIO = 1.4
# Молярная масса воздуха, кг/моль (зависит от состава атмосферы)
AIR_MOLAR_MASS = 0.029
# Динамическая вязкость воздуха в Па*с (зависит от температуры)
AIR_DYNAMIC_VISCOSITY = 0.000018
# Атмосферное давление в Паскалях (зависит от высоты и температуры)
ATMOSPHERIC_PRESSURE = 101325
# Источник пегасьей энергии в МДж/м³ (концентрация частиц должна падать с высотой)
AIR_MAGIC_ENERGY_MJ = 0.001

# Константы:
# Универсальная газовая постоянная
GAS_CONSTANT = 8.3144598
# Ускорение свободного падения
GRAVITATIONAL_ACCELERATION = 9.8
# Градусы цельсия в кельвины (0°C = 273.15K)
KELVIN_SCALE = 273.15
# Крылосила (в ваттах)
WINGPOWER = 30172

# Настройки модели:
# Летательный аппарат по умолчанию
SAMPLE = ''
# Доля тепла на нагрев рабочего вещества (для расчёта перегрева двигателя)
ENGINE_USEFUL_ENERGY = 0.9
# Воздух для двигателя при старте:
START_AIR_VOLUME = 4.4
# Площадь воздухозаборников от площади крыла (можно указать в профиле в квадратных метрах)
WING_PERCENT_INTAKES = 0.5
# Предельная скорость модели
MAX_SPEED = 500
# После набора этой высоты автопилот исполняет команды -a и -s:
MIN_ALTITUDE = 100
# Предельная высота полёта:
MAX_ALTITUDE = 1000
# Число циклов модели
#MAX_SECONDS = 86400
MAX_SECONDS = 3600
#MAX_SECONDS = 360
# Аэродинамический коэффициент, актуален для сваливания и критических углов атаки (>30°):
HORIZONTAL_BODY_DRAG_COEFFICIENT = 0.74 # Цилиндр с длиной/диаметром = 5/1 поперёк потока
# Коэффициент трения качения (пневматические шины по асфальту):
ROLLING_RESISTANCE_COEFFICIENT = 0.01
# Длина взлётно-посадочной полосы в метрах:
RUNWAY_LENGTH = 100

# Стандартная поляра крыла:
# airfoil characteristics 180 degree
# http://airfoiltools.com/airfoil/details?airfoil=n0012-il
# http://prod.sandia.gov/techlib/access-control.cgi/1980/802114.pdf
d_standard_polar = {
        # угол атаки, Cl, Cd
        -90.000:(-0.05,1.8),
        -85.000:(-0.2,1.8),
        -80.000:(-0.38,1.69),
        -75.000:(-0.5,1.68),
        -70.000:(-0.63,1.65),
        -65.000:(-0.75,1.6),
        -60.000:(-0.9,1.5),
        -55.000:(-0.95,1.4),
        -50.000:(-1.02,1.2),
        -45.000:(-1.1,1.1),
        -40.000:(-1.05,0.9),
        -35.000:(-1.0,0.7),
        -30.000:(-0.9,0.6),
        -25.000:(-0.8,0.4),
        -20.000:(-0.7,0.3),
        -15.000:(-0.6,0.2),
        -10.000:(-1.0,0.01),
        -5.000:(-0.6,0.006),
        0.000:(0.05,0.004),
        5.000:(0.6,0.006),
        10.000:(1.0,0.01),
        15.000:(0.6,0.2),
        20.000:(0.7,0.3),
        25.000:(0.8,0.4),
        30.000:(0.9,0.6),
        35.000:(1.0,0.7),
        40.000:(1.05,0.9),
        45.000:(1.1,1.1),
        50.000:(1.02,1.2),
        55.000:(0.95,1.4),
        60.000:(0.9,1.5),
        65.000:(0.75,1.6),
        70.000:(0.63,1.65),
        75.000:(0.5,1.68),
        80.000:(0.38,1.69),
        85.000:(0.2,1.8),
        90.000:(0.05,1.8),
        }

#-------------------------------------------------------------------------
# Летательные аппараты:

d_samples = {}

d_samples['Пегас'] = {
        'Масса аппарата (килограмм)':70,
        'Запас энергии (мегаджоулей)':45,
        'Объём двигателя (кубометров)':4.4,
        'Предельная мощность (мегаватт)':0.5,
        'Размах крыла (метров)':4,
        'Хорда крыла (метров)':0.35,
        'Толщина крыла (метров)':0.35/10,
        'Несущая площадь крыла (квадратных метров)':1.4,
        'Фронтальная площадь крыла (квадратных метров)':(0.35/10)*4,
        'Длина фюзеляжа (метров)':1.43,
        'Ширина фюзеляжа (метров)':0.38,
        'Высота фюзеляжа (метров)':0.48,
        'Фронтальная площадь фюзеляжа (квадратных метров)':0.2,
        'Горизонтальная площадь фюзеляжа (квадратных метров)':0.54,
        'Коэффициент лобового сопротивления фюзеляжа':0.5,
        # Ага, пони на колёсиках, потому что силу качения вычислить проще, а КПД сравним:
        'Радиус колеса шасси (метров)':0.15,
        'Дисколёт':False,
        # http://airfoiltools.com/airfoil/details?airfoil=fx76mp120-il
        'Поляра профиля крыла':{
            # Xfoil polar. Reynolds number fixed. Mach  number fixed
            # Polar key,xf-fx76mp120-il-1000000
            # Airfoil,fx76mp120-il
            # Reynolds number,1000000
            # Ncrit,9
            # Mach,0
            # Max Cl/Cd,192.611
            # Max Cl/Cd alpha,3.75
            # Url,http://airfoiltools.com/polar/csv?polar=xf-fx76mp120-il-1000000
            # 
            # Alpha,Cl,Cd,Cdp,Cm,Top_Xtr,Bot_Xtr
            -11.250:(0.2024,0.08474,0.08194,-0.1471,0.7975,0.0137),
            -11.000:(0.2090,0.08192,0.07913,-0.1480,0.7959,0.0140),
            -10.750:(0.2088,0.07788,0.07510,-0.1497,0.7942,0.0150),
            -10.500:(0.2143,0.07492,0.07213,-0.1507,0.7924,0.0150),
            -10.250:(0.2175,0.07137,0.06859,-0.1518,0.7906,0.0151),
            -10.000:(0.1738,0.08553,0.08260,-0.1563,0.7976,0.0151),
            -9.750:(0.1813,0.08231,0.07939,-0.1581,0.7957,0.0151),
            -9.500:(0.1911,0.07965,0.07674,-0.1596,0.7936,0.0151),
            -9.250:(0.1987,0.07677,0.07386,-0.1605,0.7917,0.0156),
            -9.000:(-0.0306,0.02023,0.01656,-0.2057,0.7820,0.0122),
            -8.750:(-0.0087,0.01833,0.01445,-0.2071,0.7800,0.0126),
            -8.500:(0.0165,0.01739,0.01340,-0.2078,0.7782,0.0129),
            -8.250:(0.0429,0.01690,0.01283,-0.2082,0.7763,0.0134),
            -8.000:(0.0690,0.01605,0.01184,-0.2088,0.7745,0.0139),
            -7.750:(0.0958,0.01527,0.01088,-0.2094,0.7725,0.0144),
            -7.500:(0.1232,0.01448,0.00989,-0.2100,0.7703,0.0148),
            -7.250:(0.1500,0.01392,0.00923,-0.2103,0.7689,0.0151),
            -7.000:(0.1758,0.01248,0.00756,-0.2109,0.7671,0.0160),
            -6.750:(0.2033,0.01205,0.00707,-0.2112,0.7652,0.0165),
            -6.500:(0.2312,0.01173,0.00670,-0.2114,0.7633,0.0173),
            -6.250:(0.2592,0.01136,0.00624,-0.2117,0.7614,0.0180),
            -6.000:(0.2873,0.01105,0.00584,-0.2119,0.7596,0.0187),
            -5.750:(0.3154,0.01052,0.00520,-0.2122,0.7577,0.0198),
            -5.500:(0.3442,0.01032,0.00495,-0.2126,0.7554,0.0210),
            -5.250:(0.3719,0.01011,0.00472,-0.2127,0.7538,0.0223),
            -5.000:(0.3998,0.00990,0.00447,-0.2128,0.7519,0.0234),
            -4.750:(0.4276,0.00949,0.00401,-0.2130,0.7499,0.0253),
            -4.500:(0.4558,0.00935,0.00386,-0.2131,0.7478,0.0273),
            -4.250:(0.4841,0.00928,0.00376,-0.2132,0.7458,0.0291),
            -4.000:(0.5123,0.00897,0.00342,-0.2135,0.7438,0.0322),
            -3.750:(0.5410,0.00891,0.00331,-0.2137,0.7414,0.0347),
            -3.500:(0.5690,0.00877,0.00315,-0.2138,0.7392,0.0370),
            -3.250:(0.5966,0.00858,0.00298,-0.2138,0.7370,0.0405),
            -3.000:(0.6244,0.00850,0.00290,-0.2139,0.7345,0.0434),
            -2.750:(0.6524,0.00834,0.00271,-0.2140,0.7321,0.0470),
            -2.500:(0.6803,0.00824,0.00262,-0.2141,0.7297,0.0511),
            -2.250:(0.7087,0.00822,0.00255,-0.2142,0.7273,0.0543),
            -2.000:(0.7369,0.00809,0.00243,-0.2144,0.7248,0.0608),
            -1.750:(0.7642,0.00802,0.00237,-0.2143,0.7224,0.0654),
            -1.500:(0.7917,0.00790,0.00228,-0.2143,0.7196,0.0732),
            -1.250:(0.8193,0.00785,0.00223,-0.2143,0.7167,0.0797),
            -1.000:(0.8469,0.00776,0.00216,-0.2144,0.7138,0.0912),
            -0.750:(0.8751,0.00774,0.00213,-0.2145,0.7107,0.1039),
            -0.500:(0.9019,0.00766,0.00211,-0.2144,0.7079,0.1191),
            -0.250:(0.9290,0.00759,0.00209,-0.2143,0.7046,0.1405),
            0.000:(0.9560,0.00750,0.00209,-0.2143,0.7013,0.1760),
            0.250:(0.9832,0.00742,0.00209,-0.2143,0.6981,0.2250),
            0.500:(1.0100,0.00730,0.00214,-0.2143,0.6948,0.3021),
            0.750:(1.0359,0.00708,0.00221,-0.2141,0.6910,0.4235),
            1.000:(1.0600,0.00670,0.00234,-0.2137,0.6873,0.6592),
            1.250:(1.0838,0.00659,0.00245,-0.2128,0.6834,0.7817),
            1.500:(1.1083,0.00658,0.00252,-0.2121,0.6794,0.8266),
            1.750:(1.1322,0.00654,0.00257,-0.2112,0.6747,0.8642),
            2.000:(1.1552,0.00651,0.00259,-0.2102,0.6700,0.9009),
            2.250:(1.1890,0.00645,0.00260,-0.2116,0.6654,1.0000),
            2.500:(1.2156,0.00651,0.00265,-0.2115,0.6602,1.0000),
            2.750:(1.2414,0.00659,0.00269,-0.2112,0.6546,1.0000),
            3.000:(1.2672,0.00668,0.00276,-0.2109,0.6487,1.0000),
            3.250:(1.2928,0.00676,0.00283,-0.2106,0.6423,1.0000),
            3.500:(1.3175,0.00688,0.00290,-0.2101,0.6358,1.0000),
            3.750:(1.3425,0.00697,0.00299,-0.2097,0.6285,1.0000),
            4.000:(1.3662,0.00711,0.00310,-0.2089,0.6207,1.0000),
            4.250:(1.3899,0.00724,0.00320,-0.2082,0.6117,1.0000),
            4.500:(1.4126,0.00740,0.00333,-0.2074,0.6021,1.0000),
            4.750:(1.4339,0.00759,0.00348,-0.2062,0.5921,1.0000),
            5.000:(1.4557,0.00777,0.00363,-0.2051,0.5814,1.0000),
            5.250:(1.4766,0.00797,0.00380,-0.2039,0.5709,1.0000),
            5.500:(1.4951,0.00820,0.00399,-0.2022,0.5595,1.0000),
            5.750:(1.5107,0.00847,0.00421,-0.1998,0.5474,1.0000),
            6.000:(1.5266,0.00875,0.00446,-0.1976,0.5343,1.0000),
            6.250:(1.5426,0.00906,0.00472,-0.1955,0.5209,1.0000),
            6.500:(1.5585,0.00937,0.00501,-0.1933,0.5086,1.0000),
            6.750:(1.5737,0.00973,0.00532,-0.1911,0.4963,1.0000),
            7.000:(1.5872,0.01014,0.00570,-0.1886,0.4826,1.0000),
            7.250:(1.6007,0.01060,0.00611,-0.1862,0.4700,1.0000),
            7.500:(1.6134,0.01111,0.00658,-0.1837,0.4572,1.0000),
            7.750:(1.6272,0.01163,0.00707,-0.1816,0.4438,1.0000),
            8.000:(1.6405,0.01221,0.00763,-0.1794,0.4302,1.0000),
            8.250:(1.6538,0.01285,0.00825,-0.1774,0.4170,1.0000),
            8.500:(1.6669,0.01357,0.00893,-0.1754,0.4037,1.0000),
            8.750:(1.6797,0.01436,0.00969,-0.1736,0.3904,1.0000),
            9.000:(1.6913,0.01530,0.01058,-0.1716,0.3745,1.0000),
            9.250:(1.6995,0.01650,0.01170,-0.1694,0.3539,1.0000),
            9.500:(1.7049,0.01794,0.01301,-0.1669,0.3282,1.0000),
            9.750:(1.7096,0.01946,0.01441,-0.1644,0.3048,1.0000),
            10.000:(1.7144,0.02097,0.01581,-0.1619,0.2807,1.0000),
            10.250:(1.7205,0.02242,0.01717,-0.1597,0.2625,1.0000),
            10.500:(1.7258,0.02390,0.01858,-0.1574,0.2441,1.0000),
            10.750:(1.7322,0.02532,0.01994,-0.1552,0.2280,1.0000),
            11.000:(1.7360,0.02694,0.02147,-0.1528,0.2090,1.0000),
            11.250:(1.7421,0.02840,0.02290,-0.1507,0.1959,1.0000),
            11.500:(1.7452,0.03010,0.02451,-0.1483,0.1790,1.0000),
            11.750:(1.7497,0.03174,0.02611,-0.1462,0.1654,1.0000),
            12.000:(1.7497,0.03372,0.02800,-0.1437,0.1479,1.0000),
            12.250:(1.7518,0.03559,0.02980,-0.1414,0.1330,1.0000),
            12.500:(1.7527,0.03759,0.03175,-0.1391,0.1178,1.0000),
            12.750:(1.7517,0.03978,0.03385,-0.1367,0.1008,1.0000),
            13.000:(1.7489,0.04215,0.03614,-0.1343,0.0855,1.0000),
            13.250:(1.7442,0.04474,0.03864,-0.1317,0.0692,1.0000),
            13.500:(1.7402,0.04734,0.04117,-0.1294,0.0548,1.0000),
            13.750:(1.7370,0.04993,0.04372,-0.1272,0.0440,1.0000),
            14.000:(1.7327,0.05266,0.04641,-0.1251,0.0341,1.0000),
            14.250:(1.7291,0.05539,0.04911,-0.1232,0.0258,1.0000),
            14.500:(1.7268,0.05809,0.05182,-0.1214,0.0200,1.0000),
            14.750:(1.7239,0.06091,0.05465,-0.1198,0.0153,1.0000),
            15.000:(1.7214,0.06371,0.05748,-0.1182,0.0121,1.0000),
            15.250:(1.7215,0.06633,0.06015,-0.1170,0.0104,1.0000),
            15.500:(1.7186,0.06935,0.06323,-0.1157,0.0087,1.0000),
            15.750:(1.7195,0.07201,0.06596,-0.1148,0.0079,1.0000),
            16.000:(1.7172,0.07513,0.06913,-0.1138,0.0072,1.0000),
            16.250:(1.7138,0.07840,0.07249,-0.1129,0.0066,1.0000),
            16.500:(1.7143,0.08127,0.07544,-0.1123,0.0063,1.0000),
            16.750:(1.7138,0.08434,0.07860,-0.1118,0.0060,1.0000),
            17.000:(1.7127,0.08756,0.08190,-0.1114,0.0057,1.0000),
            17.250:(1.7100,0.09105,0.08547,-0.1111,0.0054,1.0000),
            17.500:(1.7069,0.09466,0.08917,-0.1110,0.0053,1.0000),
            17.750:(1.6981,0.09916,0.09377,-0.1111,0.0050,1.0000),
            },        
        }

d_samples['Рэйнбоу "Рэйнбум" Дэш'] = {
        # Пегаска предельных параметров.
        'Масса аппарата (килограмм)':70,
        'Запас энергии (мегаджоулей)':45,
        'Объём двигателя (кубометров)':4.4,
        'Предельная мощность (мегаватт)':5,
        'Размах крыла (метров)':4,
        'Хорда крыла (метров)':0.35,
        'Толщина крыла (метров)':0.35/10,
        'Несущая площадь крыла (квадратных метров)':1.4,
        'Фронтальная площадь крыла (квадратных метров)':(0.35/10)*4,
        'Длина фюзеляжа (метров)':1.43,
        'Ширина фюзеляжа (метров)':0.38,
        'Высота фюзеляжа (метров)':0.48,
        'Фронтальная площадь фюзеляжа (квадратных метров)':0.2,
        'Горизонтальная площадь фюзеляжа (квадратных метров)':0.54,
        'Коэффициент лобового сопротивления фюзеляжа':0.3,
        'Радиус колеса шасси (метров)':0.15,
        # Индуктивное сопротивление воздуха игнорирует:
        'Дисколёт':True,
        # http://airfoiltools.com/airfoil/details?airfoil=fx76mp120-il
        'Поляра профиля крыла':{
            # Xfoil polar. Reynolds number fixed. Mach  number fixed
            # Polar key,xf-fx76mp120-il-1000000
            # Airfoil,fx76mp120-il
            # Reynolds number,1000000
            # Ncrit,9
            # Mach,0
            # Max Cl/Cd,192.611
            # Max Cl/Cd alpha,3.75
            # Url,http://airfoiltools.com/polar/csv?polar=xf-fx76mp120-il-1000000
            # 
            # Alpha,Cl,Cd,Cdp,Cm,Top_Xtr,Bot_Xtr
            -11.250:(0.2024,0.08474,0.08194,-0.1471,0.7975,0.0137),
            -11.000:(0.2090,0.08192,0.07913,-0.1480,0.7959,0.0140),
            -10.750:(0.2088,0.07788,0.07510,-0.1497,0.7942,0.0150),
            -10.500:(0.2143,0.07492,0.07213,-0.1507,0.7924,0.0150),
            -10.250:(0.2175,0.07137,0.06859,-0.1518,0.7906,0.0151),
            -10.000:(0.1738,0.08553,0.08260,-0.1563,0.7976,0.0151),
            -9.750:(0.1813,0.08231,0.07939,-0.1581,0.7957,0.0151),
            -9.500:(0.1911,0.07965,0.07674,-0.1596,0.7936,0.0151),
            -9.250:(0.1987,0.07677,0.07386,-0.1605,0.7917,0.0156),
            -9.000:(-0.0306,0.02023,0.01656,-0.2057,0.7820,0.0122),
            -8.750:(-0.0087,0.01833,0.01445,-0.2071,0.7800,0.0126),
            -8.500:(0.0165,0.01739,0.01340,-0.2078,0.7782,0.0129),
            -8.250:(0.0429,0.01690,0.01283,-0.2082,0.7763,0.0134),
            -8.000:(0.0690,0.01605,0.01184,-0.2088,0.7745,0.0139),
            -7.750:(0.0958,0.01527,0.01088,-0.2094,0.7725,0.0144),
            -7.500:(0.1232,0.01448,0.00989,-0.2100,0.7703,0.0148),
            -7.250:(0.1500,0.01392,0.00923,-0.2103,0.7689,0.0151),
            -7.000:(0.1758,0.01248,0.00756,-0.2109,0.7671,0.0160),
            -6.750:(0.2033,0.01205,0.00707,-0.2112,0.7652,0.0165),
            -6.500:(0.2312,0.01173,0.00670,-0.2114,0.7633,0.0173),
            -6.250:(0.2592,0.01136,0.00624,-0.2117,0.7614,0.0180),
            -6.000:(0.2873,0.01105,0.00584,-0.2119,0.7596,0.0187),
            -5.750:(0.3154,0.01052,0.00520,-0.2122,0.7577,0.0198),
            -5.500:(0.3442,0.01032,0.00495,-0.2126,0.7554,0.0210),
            -5.250:(0.3719,0.01011,0.00472,-0.2127,0.7538,0.0223),
            -5.000:(0.3998,0.00990,0.00447,-0.2128,0.7519,0.0234),
            -4.750:(0.4276,0.00949,0.00401,-0.2130,0.7499,0.0253),
            -4.500:(0.4558,0.00935,0.00386,-0.2131,0.7478,0.0273),
            -4.250:(0.4841,0.00928,0.00376,-0.2132,0.7458,0.0291),
            -4.000:(0.5123,0.00897,0.00342,-0.2135,0.7438,0.0322),
            -3.750:(0.5410,0.00891,0.00331,-0.2137,0.7414,0.0347),
            -3.500:(0.5690,0.00877,0.00315,-0.2138,0.7392,0.0370),
            -3.250:(0.5966,0.00858,0.00298,-0.2138,0.7370,0.0405),
            -3.000:(0.6244,0.00850,0.00290,-0.2139,0.7345,0.0434),
            -2.750:(0.6524,0.00834,0.00271,-0.2140,0.7321,0.0470),
            -2.500:(0.6803,0.00824,0.00262,-0.2141,0.7297,0.0511),
            -2.250:(0.7087,0.00822,0.00255,-0.2142,0.7273,0.0543),
            -2.000:(0.7369,0.00809,0.00243,-0.2144,0.7248,0.0608),
            -1.750:(0.7642,0.00802,0.00237,-0.2143,0.7224,0.0654),
            -1.500:(0.7917,0.00790,0.00228,-0.2143,0.7196,0.0732),
            -1.250:(0.8193,0.00785,0.00223,-0.2143,0.7167,0.0797),
            -1.000:(0.8469,0.00776,0.00216,-0.2144,0.7138,0.0912),
            -0.750:(0.8751,0.00774,0.00213,-0.2145,0.7107,0.1039),
            -0.500:(0.9019,0.00766,0.00211,-0.2144,0.7079,0.1191),
            -0.250:(0.9290,0.00759,0.00209,-0.2143,0.7046,0.1405),
            0.000:(0.9560,0.00750,0.00209,-0.2143,0.7013,0.1760),
            0.250:(0.9832,0.00742,0.00209,-0.2143,0.6981,0.2250),
            0.500:(1.0100,0.00730,0.00214,-0.2143,0.6948,0.3021),
            0.750:(1.0359,0.00708,0.00221,-0.2141,0.6910,0.4235),
            1.000:(1.0600,0.00670,0.00234,-0.2137,0.6873,0.6592),
            1.250:(1.0838,0.00659,0.00245,-0.2128,0.6834,0.7817),
            1.500:(1.1083,0.00658,0.00252,-0.2121,0.6794,0.8266),
            1.750:(1.1322,0.00654,0.00257,-0.2112,0.6747,0.8642),
            2.000:(1.1552,0.00651,0.00259,-0.2102,0.6700,0.9009),
            2.250:(1.1890,0.00645,0.00260,-0.2116,0.6654,1.0000),
            2.500:(1.2156,0.00651,0.00265,-0.2115,0.6602,1.0000),
            2.750:(1.2414,0.00659,0.00269,-0.2112,0.6546,1.0000),
            3.000:(1.2672,0.00668,0.00276,-0.2109,0.6487,1.0000),
            3.250:(1.2928,0.00676,0.00283,-0.2106,0.6423,1.0000),
            3.500:(1.3175,0.00688,0.00290,-0.2101,0.6358,1.0000),
            3.750:(1.3425,0.00697,0.00299,-0.2097,0.6285,1.0000),
            4.000:(1.3662,0.00711,0.00310,-0.2089,0.6207,1.0000),
            4.250:(1.3899,0.00724,0.00320,-0.2082,0.6117,1.0000),
            4.500:(1.4126,0.00740,0.00333,-0.2074,0.6021,1.0000),
            4.750:(1.4339,0.00759,0.00348,-0.2062,0.5921,1.0000),
            5.000:(1.4557,0.00777,0.00363,-0.2051,0.5814,1.0000),
            5.250:(1.4766,0.00797,0.00380,-0.2039,0.5709,1.0000),
            5.500:(1.4951,0.00820,0.00399,-0.2022,0.5595,1.0000),
            5.750:(1.5107,0.00847,0.00421,-0.1998,0.5474,1.0000),
            6.000:(1.5266,0.00875,0.00446,-0.1976,0.5343,1.0000),
            6.250:(1.5426,0.00906,0.00472,-0.1955,0.5209,1.0000),
            6.500:(1.5585,0.00937,0.00501,-0.1933,0.5086,1.0000),
            6.750:(1.5737,0.00973,0.00532,-0.1911,0.4963,1.0000),
            7.000:(1.5872,0.01014,0.00570,-0.1886,0.4826,1.0000),
            7.250:(1.6007,0.01060,0.00611,-0.1862,0.4700,1.0000),
            7.500:(1.6134,0.01111,0.00658,-0.1837,0.4572,1.0000),
            7.750:(1.6272,0.01163,0.00707,-0.1816,0.4438,1.0000),
            8.000:(1.6405,0.01221,0.00763,-0.1794,0.4302,1.0000),
            8.250:(1.6538,0.01285,0.00825,-0.1774,0.4170,1.0000),
            8.500:(1.6669,0.01357,0.00893,-0.1754,0.4037,1.0000),
            8.750:(1.6797,0.01436,0.00969,-0.1736,0.3904,1.0000),
            9.000:(1.6913,0.01530,0.01058,-0.1716,0.3745,1.0000),
            9.250:(1.6995,0.01650,0.01170,-0.1694,0.3539,1.0000),
            9.500:(1.7049,0.01794,0.01301,-0.1669,0.3282,1.0000),
            9.750:(1.7096,0.01946,0.01441,-0.1644,0.3048,1.0000),
            10.000:(1.7144,0.02097,0.01581,-0.1619,0.2807,1.0000),
            10.250:(1.7205,0.02242,0.01717,-0.1597,0.2625,1.0000),
            10.500:(1.7258,0.02390,0.01858,-0.1574,0.2441,1.0000),
            10.750:(1.7322,0.02532,0.01994,-0.1552,0.2280,1.0000),
            11.000:(1.7360,0.02694,0.02147,-0.1528,0.2090,1.0000),
            11.250:(1.7421,0.02840,0.02290,-0.1507,0.1959,1.0000),
            11.500:(1.7452,0.03010,0.02451,-0.1483,0.1790,1.0000),
            11.750:(1.7497,0.03174,0.02611,-0.1462,0.1654,1.0000),
            12.000:(1.7497,0.03372,0.02800,-0.1437,0.1479,1.0000),
            12.250:(1.7518,0.03559,0.02980,-0.1414,0.1330,1.0000),
            12.500:(1.7527,0.03759,0.03175,-0.1391,0.1178,1.0000),
            12.750:(1.7517,0.03978,0.03385,-0.1367,0.1008,1.0000),
            13.000:(1.7489,0.04215,0.03614,-0.1343,0.0855,1.0000),
            13.250:(1.7442,0.04474,0.03864,-0.1317,0.0692,1.0000),
            13.500:(1.7402,0.04734,0.04117,-0.1294,0.0548,1.0000),
            13.750:(1.7370,0.04993,0.04372,-0.1272,0.0440,1.0000),
            14.000:(1.7327,0.05266,0.04641,-0.1251,0.0341,1.0000),
            14.250:(1.7291,0.05539,0.04911,-0.1232,0.0258,1.0000),
            14.500:(1.7268,0.05809,0.05182,-0.1214,0.0200,1.0000),
            14.750:(1.7239,0.06091,0.05465,-0.1198,0.0153,1.0000),
            15.000:(1.7214,0.06371,0.05748,-0.1182,0.0121,1.0000),
            15.250:(1.7215,0.06633,0.06015,-0.1170,0.0104,1.0000),
            15.500:(1.7186,0.06935,0.06323,-0.1157,0.0087,1.0000),
            15.750:(1.7195,0.07201,0.06596,-0.1148,0.0079,1.0000),
            16.000:(1.7172,0.07513,0.06913,-0.1138,0.0072,1.0000),
            16.250:(1.7138,0.07840,0.07249,-0.1129,0.0066,1.0000),
            16.500:(1.7143,0.08127,0.07544,-0.1123,0.0063,1.0000),
            16.750:(1.7138,0.08434,0.07860,-0.1118,0.0060,1.0000),
            17.000:(1.7127,0.08756,0.08190,-0.1114,0.0057,1.0000),
            17.250:(1.7100,0.09105,0.08547,-0.1111,0.0054,1.0000),
            17.500:(1.7069,0.09466,0.08917,-0.1110,0.0053,1.0000),
            17.750:(1.6981,0.09916,0.09377,-0.1111,0.0050,1.0000),
            },        
        }

d_samples['Лёгкий грузовой планёр (1 пегас)'] = {
        # http://www.aeros.com.ua/structure/al/al12_ru.php
        'Масса аппарата (килограмм)':300,
        'Запас энергии (мегаджоулей)':45,
        'Объём двигателя (кубометров)':4.4,
        'Предельная мощность (мегаватт)':0.5,
        'Размах крыла (метров)':13.3,
        'Хорда крыла (метров)':1,
        'Толщина крыла (метров)':1/10,
        'Несущая площадь крыла (квадратных метров)':13,
        'Длина фюзеляжа (метров)':7.4,
        'Ширина фюзеляжа (метров)':0.5,
        'Высота фюзеляжа (метров)':0.6,
        'Коэффициент лобового сопротивления фюзеляжа':0.04,
        'Радиус колеса шасси (метров)':0.15,
        'Дисколёт':False,
        'Поляра профиля крыла':{
            # Xfoil polar. Reynolds number fixed. Mach  number fixed
            # Polar key,xf-goe796-il-1000000-n5
            # Airfoil,goe796-il
            # Reynolds number,1000000
            # Ncrit,5
            # Mach,0
            # Max Cl/Cd,105.186
            # Max Cl/Cd alpha,4.75
            # Url,http://airfoiltools.com/polar/csv?polar=xf-goe796-il-1000000-n5
            # 
            # Alpha,Cl,Cd,Cdp,Cm,Top_Xtr,Bot_Xtr
            -14.500:(-0.7184,0.09505,0.09285,-0.0435,1.0000,0.0126),
            -14.250:(-0.7933,0.07833,0.07598,-0.0538,1.0000,0.0125),
            -14.000:(-0.9955,0.03555,0.03243,-0.0901,1.0000,0.0118),
            -13.750:(-1.0103,0.03312,0.02988,-0.0876,0.9999,0.0118),
            -13.500:(-0.9952,0.03086,0.02748,-0.0893,0.9950,0.0120),
            -13.250:(-0.9776,0.02911,0.02561,-0.0903,0.9899,0.0121),
            -13.000:(-0.9582,0.02761,0.02400,-0.0910,0.9853,0.0122),
            -12.750:(-0.9381,0.02629,0.02257,-0.0915,0.9810,0.0123),
            -12.500:(-0.9188,0.02509,0.02127,-0.0914,0.9755,0.0124),
            -12.000:(-0.8789,0.02298,0.01894,-0.0909,0.9651,0.0127),
            -11.750:(-0.8587,0.02205,0.01790,-0.0904,0.9598,0.0128),
            -11.500:(-0.8380,0.02120,0.01694,-0.0899,0.9547,0.0129),
            -11.250:(-0.8166,0.02044,0.01609,-0.0893,0.9491,0.0131),
            -11.000:(-0.7947,0.01974,0.01529,-0.0887,0.9440,0.0133),
            -10.750:(-0.7721,0.01905,0.01451,-0.0882,0.9390,0.0134),
            -10.500:(-0.7492,0.01841,0.01377,-0.0878,0.9332,0.0136),
            -10.250:(-0.7259,0.01782,0.01309,-0.0872,0.9279,0.0138),
            -10.000:(-0.7018,0.01723,0.01241,-0.0869,0.9227,0.0139),
            -9.750:(-0.6775,0.01670,0.01180,-0.0865,0.9166,0.0141),
            -9.500:(-0.6529,0.01622,0.01123,-0.0861,0.9109,0.0142),
            -9.250:(-0.6282,0.01566,0.01058,-0.0858,0.9043,0.0143),
            -9.000:(-0.6034,0.01514,0.00997,-0.0854,0.8977,0.0143),
            -8.750:(-0.5780,0.01465,0.00940,-0.0851,0.8909,0.0144),
            -8.500:(-0.5526,0.01419,0.00885,-0.0848,0.8830,0.0144),
            -8.250:(-0.5268,0.01375,0.00833,-0.0845,0.8749,0.0144),
            -8.000:(-0.5009,0.01335,0.00783,-0.0842,0.8664,0.0145),
            -7.750:(-0.4746,0.01295,0.00736,-0.0840,0.8571,0.0145),
            -7.500:(-0.4483,0.01259,0.00692,-0.0838,0.8471,0.0145),
            -7.250:(-0.4223,0.01217,0.00640,-0.0835,0.8357,0.0146),
            -7.000:(-0.3959,0.01178,0.00592,-0.0833,0.8236,0.0147),
            -6.750:(-0.3692,0.01144,0.00549,-0.0831,0.8118,0.0148),
            -6.500:(-0.3423,0.01114,0.00510,-0.0829,0.7998,0.0149),
            -6.250:(-0.3154,0.01087,0.00474,-0.0828,0.7876,0.0150),
            -6.000:(-0.2882,0.01062,0.00441,-0.0826,0.7757,0.0151),
            -5.750:(-0.2607,0.01039,0.00411,-0.0825,0.7654,0.0153),
            -5.500:(-0.2332,0.01018,0.00383,-0.0825,0.7565,0.0154),
            -5.250:(-0.2055,0.00997,0.00357,-0.0824,0.7476,0.0156),
            -5.000:(-0.1777,0.00979,0.00333,-0.0824,0.7395,0.0159),
            -4.750:(-0.1499,0.00963,0.00312,-0.0824,0.7308,0.0162),
            -4.500:(-0.1219,0.00948,0.00292,-0.0824,0.7226,0.0164),
            -4.250:(-0.0940,0.00936,0.00274,-0.0823,0.7136,0.0166),
            -4.000:(-0.0658,0.00923,0.00257,-0.0824,0.7061,0.0169),
            -3.750:(-0.0377,0.00912,0.00241,-0.0824,0.6992,0.0174),
            -3.500:(-0.0093,0.00901,0.00228,-0.0824,0.6933,0.0178),
            -3.250:(0.0190,0.00890,0.00214,-0.0825,0.6860,0.0192),
            -3.000:(0.0467,0.00869,0.00198,-0.0825,0.6794,0.0313),
            -2.750:(0.0750,0.00854,0.00187,-0.0826,0.6736,0.0427),
            -2.500:(0.1033,0.00846,0.00178,-0.0826,0.6672,0.0481),
            -2.250:(0.1318,0.00838,0.00170,-0.0827,0.6613,0.0529),
            -2.000:(0.1601,0.00830,0.00163,-0.0828,0.6542,0.0580),
            -1.750:(0.1883,0.00822,0.00156,-0.0829,0.6468,0.0684),
            -1.500:(0.2165,0.00811,0.00153,-0.0829,0.6383,0.0873),
            -1.250:(0.2449,0.00809,0.00150,-0.0830,0.6311,0.0948),
            -1.000:(0.2736,0.00806,0.00146,-0.0832,0.6248,0.0989),
            -0.500:(0.3306,0.00799,0.00141,-0.0834,0.6132,0.1106),
            -0.250:(0.3590,0.00795,0.00139,-0.0835,0.6063,0.1202),
            0.000:(0.3872,0.00794,0.00138,-0.0835,0.5963,0.1273),
            0.250:(0.4151,0.00794,0.00137,-0.0836,0.5828,0.1391),
            0.500:(0.4428,0.00791,0.00138,-0.0836,0.5701,0.1624),
            0.750:(0.4706,0.00786,0.00139,-0.0836,0.5590,0.1962),
            1.000:(0.4985,0.00782,0.00141,-0.0837,0.5481,0.2299),
            1.250:(0.5260,0.00778,0.00145,-0.0837,0.5355,0.2714),
            1.750:(0.5788,0.00755,0.00157,-0.0834,0.4970,0.4509),
            2.000:(0.6045,0.00750,0.00167,-0.0832,0.4719,0.5421),
            2.250:(0.6288,0.00739,0.00179,-0.0827,0.4441,0.6663),
            2.500:(0.6521,0.00734,0.00194,-0.0818,0.4149,0.7780),
            2.750:(0.6711,0.00719,0.00213,-0.0797,0.3927,0.9270),
            3.000:(0.7055,0.00741,0.00229,-0.0811,0.3718,0.9783),
            3.250:(0.7464,0.00765,0.00244,-0.0841,0.3551,0.9956),
            3.750:(0.8076,0.00797,0.00267,-0.0856,0.3354,1.0000),
            4.250:(0.8568,0.00829,0.00291,-0.0843,0.3178,1.0000),
            4.500:(0.8816,0.00847,0.00304,-0.0838,0.3105,1.0000),
            4.750:(0.9067,0.00862,0.00317,-0.0833,0.3014,1.0000),
            5.000:(0.9310,0.00886,0.00333,-0.0826,0.2858,1.0000),
            5.250:(0.9548,0.00913,0.00351,-0.0820,0.2673,1.0000),
            5.500:(0.9781,0.00945,0.00371,-0.0812,0.2422,1.0000),
            5.750:(0.9971,0.01009,0.00406,-0.0798,0.1915,1.0000),
            6.250:(1.0416,0.01088,0.00465,-0.0780,0.1550,1.0000),
            6.500:(1.0656,0.01115,0.00490,-0.0774,0.1477,1.0000),
            6.750:(1.0900,0.01138,0.00512,-0.0769,0.1422,1.0000),
            7.000:(1.1135,0.01167,0.00537,-0.0762,0.1350,1.0000),
            7.250:(1.1374,0.01192,0.00561,-0.0756,0.1278,1.0000),
            7.500:(1.1600,0.01226,0.00590,-0.0748,0.1180,1.0000),
            7.750:(1.1817,0.01264,0.00621,-0.0739,0.1048,1.0000),
            8.000:(1.2018,0.01313,0.00659,-0.0727,0.0880,1.0000),
            8.250:(1.2218,0.01359,0.00699,-0.0716,0.0761,1.0000),
            8.500:(1.2422,0.01401,0.00738,-0.0704,0.0685,1.0000),
            8.750:(1.2625,0.01440,0.00775,-0.0693,0.0626,1.0000),
            9.000:(1.2818,0.01482,0.00815,-0.0680,0.0568,1.0000),
            9.250:(1.2992,0.01525,0.00856,-0.0663,0.0515,1.0000),
            9.500:(1.3167,0.01567,0.00899,-0.0647,0.0476,1.0000),
            9.750:(1.3326,0.01620,0.00949,-0.0629,0.0414,1.0000),
            10.000:(1.3472,0.01682,0.01007,-0.0609,0.0335,1.0000),
            10.250:(1.3592,0.01761,0.01080,-0.0587,0.0236,1.0000),
            10.500:(1.3730,0.01833,0.01150,-0.0568,0.0193,1.0000),
            10.750:(1.3881,0.01898,0.01217,-0.0552,0.0171,1.0000),
            11.000:(1.4035,0.01962,0.01284,-0.0536,0.0158,1.0000),
            11.250:(1.4179,0.02034,0.01359,-0.0520,0.0146,1.0000),
            11.500:(1.4330,0.02104,0.01432,-0.0506,0.0138,1.0000),
            11.750:(1.4479,0.02175,0.01507,-0.0492,0.0129,1.0000),
            12.000:(1.4615,0.02257,0.01593,-0.0477,0.0119,1.0000),
            12.250:(1.4742,0.02348,0.01687,-0.0462,0.0109,1.0000),
            12.500:(1.4872,0.02438,0.01781,-0.0448,0.0099,1.0000),
            12.750:(1.4988,0.02541,0.01887,-0.0434,0.0088,1.0000),
            13.000:(1.5096,0.02654,0.02002,-0.0420,0.0083,1.0000),
            13.250:(1.5198,0.02773,0.02125,-0.0406,0.0079,1.0000),
            13.500:(1.5295,0.02899,0.02256,-0.0393,0.0077,1.0000),
            13.750:(1.5386,0.03036,0.02398,-0.0380,0.0074,1.0000),
            14.000:(1.5468,0.03182,0.02550,-0.0368,0.0071,1.0000),
            14.250:(1.5543,0.03338,0.02713,-0.0357,0.0069,1.0000),
            14.500:(1.5611,0.03505,0.02886,-0.0346,0.0067,1.0000),
            14.750:(1.5686,0.03671,0.03059,-0.0337,0.0066,1.0000),
            15.000:(1.5750,0.03848,0.03244,-0.0328,0.0065,1.0000),
            15.250:(1.5805,0.04039,0.03442,-0.0320,0.0063,1.0000),
            15.500:(1.5852,0.04244,0.03656,-0.0312,0.0062,1.0000),
            15.750:(1.5889,0.04465,0.03885,-0.0306,0.0060,1.0000),
            16.000:(1.5915,0.04701,0.04129,-0.0300,0.0058,1.0000),
            16.250:(1.5931,0.04954,0.04391,-0.0296,0.0057,1.0000),
            16.500:(1.5934,0.05229,0.04674,-0.0292,0.0055,1.0000),
            16.750:(1.5924,0.05527,0.04981,-0.0290,0.0054,1.0000),
            17.000:(1.5899,0.05847,0.05310,-0.0289,0.0052,1.0000),
            17.250:(1.5853,0.06202,0.05674,-0.0290,0.0051,1.0000),
            17.500:(1.5790,0.06593,0.06075,-0.0293,0.0050,1.0000),
            17.750:(1.5765,0.06941,0.06433,-0.0297,0.0049,1.0000),
            18.000:(1.5732,0.07306,0.06808,-0.0302,0.0048,1.0000),
            18.250:(1.5679,0.07706,0.07219,-0.0309,0.0048,1.0000),
            18.500:(1.5617,0.08128,0.07650,-0.0318,0.0047,1.0000),
            18.750:(1.5542,0.08577,0.08111,-0.0329,0.0046,1.0000),
            19.000:(1.5451,0.09058,0.08603,-0.0342,0.0045,1.0000),
            19.250:(1.5352,0.09557,0.09112,-0.0356,0.0044,1.0000),
            },
        }

d_samples['Тяжёлый грузовой планёр (18 пегасов)'] = {
        # https://en.wikipedia.org/wiki/Caproni_Ca.4
        # https://ru.wikipedia.org/wiki/Short_SC.7_Skyvan
        # https://en.wikipedia.org/wiki/Short_SC.7_Skyvan
        'Масса аппарата (килограмм)':5500+18*70,
        'Запас энергии (мегаджоулей)':45*18,
        'Объём двигателя (кубометров)':4.4*18,
        'Предельная мощность (мегаватт)':0.5*18,
        'Размах крыла (метров)':29.4,
        'Хорда крыла (метров)':2.4,
        'Толщина крыла (метров)':2.4/10,
        'Несущая площадь крыла (квадратных метров)':200,
        'Фронтальная площадь крыла (квадратных метров)':(2.4/10)*29.4,
        'Длина фюзеляжа (метров)':17.4,
        'Ширина фюзеляжа (метров)':2.4,
        'Высота фюзеляжа (метров)':2.6,
        'Фронтальная площадь фюзеляжа (квадратных метров)':5.25,
        'Коэффициент лобового сопротивления фюзеляжа':0.1,
        'Радиус колеса шасси (метров)':0.3,
        'Дисколёт':False,
        # Сомнительно. Нужно найти подходящую поляру для триплана:
        'Поляра профиля крыла':{
            # Xfoil polar. Reynolds number fixed. Mach  number fixed
            # Polar key,xf-goe796-il-1000000-n5
            # Airfoil,goe796-il
            # Reynolds number,1000000
            # Ncrit,5
            # Mach,0
            # Max Cl/Cd,105.186
            # Max Cl/Cd alpha,4.75
            # Url,http://airfoiltools.com/polar/csv?polar=xf-goe796-il-1000000-n5
            # 
            # Alpha,Cl,Cd,Cdp,Cm,Top_Xtr,Bot_Xtr
            -14.500:(-0.7184,0.09505,0.09285,-0.0435,1.0000,0.0126),
            -14.250:(-0.7933,0.07833,0.07598,-0.0538,1.0000,0.0125),
            -14.000:(-0.9955,0.03555,0.03243,-0.0901,1.0000,0.0118),
            -13.750:(-1.0103,0.03312,0.02988,-0.0876,0.9999,0.0118),
            -13.500:(-0.9952,0.03086,0.02748,-0.0893,0.9950,0.0120),
            -13.250:(-0.9776,0.02911,0.02561,-0.0903,0.9899,0.0121),
            -13.000:(-0.9582,0.02761,0.02400,-0.0910,0.9853,0.0122),
            -12.750:(-0.9381,0.02629,0.02257,-0.0915,0.9810,0.0123),
            -12.500:(-0.9188,0.02509,0.02127,-0.0914,0.9755,0.0124),
            -12.000:(-0.8789,0.02298,0.01894,-0.0909,0.9651,0.0127),
            -11.750:(-0.8587,0.02205,0.01790,-0.0904,0.9598,0.0128),
            -11.500:(-0.8380,0.02120,0.01694,-0.0899,0.9547,0.0129),
            -11.250:(-0.8166,0.02044,0.01609,-0.0893,0.9491,0.0131),
            -11.000:(-0.7947,0.01974,0.01529,-0.0887,0.9440,0.0133),
            -10.750:(-0.7721,0.01905,0.01451,-0.0882,0.9390,0.0134),
            -10.500:(-0.7492,0.01841,0.01377,-0.0878,0.9332,0.0136),
            -10.250:(-0.7259,0.01782,0.01309,-0.0872,0.9279,0.0138),
            -10.000:(-0.7018,0.01723,0.01241,-0.0869,0.9227,0.0139),
            -9.750:(-0.6775,0.01670,0.01180,-0.0865,0.9166,0.0141),
            -9.500:(-0.6529,0.01622,0.01123,-0.0861,0.9109,0.0142),
            -9.250:(-0.6282,0.01566,0.01058,-0.0858,0.9043,0.0143),
            -9.000:(-0.6034,0.01514,0.00997,-0.0854,0.8977,0.0143),
            -8.750:(-0.5780,0.01465,0.00940,-0.0851,0.8909,0.0144),
            -8.500:(-0.5526,0.01419,0.00885,-0.0848,0.8830,0.0144),
            -8.250:(-0.5268,0.01375,0.00833,-0.0845,0.8749,0.0144),
            -8.000:(-0.5009,0.01335,0.00783,-0.0842,0.8664,0.0145),
            -7.750:(-0.4746,0.01295,0.00736,-0.0840,0.8571,0.0145),
            -7.500:(-0.4483,0.01259,0.00692,-0.0838,0.8471,0.0145),
            -7.250:(-0.4223,0.01217,0.00640,-0.0835,0.8357,0.0146),
            -7.000:(-0.3959,0.01178,0.00592,-0.0833,0.8236,0.0147),
            -6.750:(-0.3692,0.01144,0.00549,-0.0831,0.8118,0.0148),
            -6.500:(-0.3423,0.01114,0.00510,-0.0829,0.7998,0.0149),
            -6.250:(-0.3154,0.01087,0.00474,-0.0828,0.7876,0.0150),
            -6.000:(-0.2882,0.01062,0.00441,-0.0826,0.7757,0.0151),
            -5.750:(-0.2607,0.01039,0.00411,-0.0825,0.7654,0.0153),
            -5.500:(-0.2332,0.01018,0.00383,-0.0825,0.7565,0.0154),
            -5.250:(-0.2055,0.00997,0.00357,-0.0824,0.7476,0.0156),
            -5.000:(-0.1777,0.00979,0.00333,-0.0824,0.7395,0.0159),
            -4.750:(-0.1499,0.00963,0.00312,-0.0824,0.7308,0.0162),
            -4.500:(-0.1219,0.00948,0.00292,-0.0824,0.7226,0.0164),
            -4.250:(-0.0940,0.00936,0.00274,-0.0823,0.7136,0.0166),
            -4.000:(-0.0658,0.00923,0.00257,-0.0824,0.7061,0.0169),
            -3.750:(-0.0377,0.00912,0.00241,-0.0824,0.6992,0.0174),
            -3.500:(-0.0093,0.00901,0.00228,-0.0824,0.6933,0.0178),
            -3.250:(0.0190,0.00890,0.00214,-0.0825,0.6860,0.0192),
            -3.000:(0.0467,0.00869,0.00198,-0.0825,0.6794,0.0313),
            -2.750:(0.0750,0.00854,0.00187,-0.0826,0.6736,0.0427),
            -2.500:(0.1033,0.00846,0.00178,-0.0826,0.6672,0.0481),
            -2.250:(0.1318,0.00838,0.00170,-0.0827,0.6613,0.0529),
            -2.000:(0.1601,0.00830,0.00163,-0.0828,0.6542,0.0580),
            -1.750:(0.1883,0.00822,0.00156,-0.0829,0.6468,0.0684),
            -1.500:(0.2165,0.00811,0.00153,-0.0829,0.6383,0.0873),
            -1.250:(0.2449,0.00809,0.00150,-0.0830,0.6311,0.0948),
            -1.000:(0.2736,0.00806,0.00146,-0.0832,0.6248,0.0989),
            -0.500:(0.3306,0.00799,0.00141,-0.0834,0.6132,0.1106),
            -0.250:(0.3590,0.00795,0.00139,-0.0835,0.6063,0.1202),
            0.000:(0.3872,0.00794,0.00138,-0.0835,0.5963,0.1273),
            0.250:(0.4151,0.00794,0.00137,-0.0836,0.5828,0.1391),
            0.500:(0.4428,0.00791,0.00138,-0.0836,0.5701,0.1624),
            0.750:(0.4706,0.00786,0.00139,-0.0836,0.5590,0.1962),
            1.000:(0.4985,0.00782,0.00141,-0.0837,0.5481,0.2299),
            1.250:(0.5260,0.00778,0.00145,-0.0837,0.5355,0.2714),
            1.750:(0.5788,0.00755,0.00157,-0.0834,0.4970,0.4509),
            2.000:(0.6045,0.00750,0.00167,-0.0832,0.4719,0.5421),
            2.250:(0.6288,0.00739,0.00179,-0.0827,0.4441,0.6663),
            2.500:(0.6521,0.00734,0.00194,-0.0818,0.4149,0.7780),
            2.750:(0.6711,0.00719,0.00213,-0.0797,0.3927,0.9270),
            3.000:(0.7055,0.00741,0.00229,-0.0811,0.3718,0.9783),
            3.250:(0.7464,0.00765,0.00244,-0.0841,0.3551,0.9956),
            3.750:(0.8076,0.00797,0.00267,-0.0856,0.3354,1.0000),
            4.250:(0.8568,0.00829,0.00291,-0.0843,0.3178,1.0000),
            4.500:(0.8816,0.00847,0.00304,-0.0838,0.3105,1.0000),
            4.750:(0.9067,0.00862,0.00317,-0.0833,0.3014,1.0000),
            5.000:(0.9310,0.00886,0.00333,-0.0826,0.2858,1.0000),
            5.250:(0.9548,0.00913,0.00351,-0.0820,0.2673,1.0000),
            5.500:(0.9781,0.00945,0.00371,-0.0812,0.2422,1.0000),
            5.750:(0.9971,0.01009,0.00406,-0.0798,0.1915,1.0000),
            6.250:(1.0416,0.01088,0.00465,-0.0780,0.1550,1.0000),
            6.500:(1.0656,0.01115,0.00490,-0.0774,0.1477,1.0000),
            6.750:(1.0900,0.01138,0.00512,-0.0769,0.1422,1.0000),
            7.000:(1.1135,0.01167,0.00537,-0.0762,0.1350,1.0000),
            7.250:(1.1374,0.01192,0.00561,-0.0756,0.1278,1.0000),
            7.500:(1.1600,0.01226,0.00590,-0.0748,0.1180,1.0000),
            7.750:(1.1817,0.01264,0.00621,-0.0739,0.1048,1.0000),
            8.000:(1.2018,0.01313,0.00659,-0.0727,0.0880,1.0000),
            8.250:(1.2218,0.01359,0.00699,-0.0716,0.0761,1.0000),
            8.500:(1.2422,0.01401,0.00738,-0.0704,0.0685,1.0000),
            8.750:(1.2625,0.01440,0.00775,-0.0693,0.0626,1.0000),
            9.000:(1.2818,0.01482,0.00815,-0.0680,0.0568,1.0000),
            9.250:(1.2992,0.01525,0.00856,-0.0663,0.0515,1.0000),
            9.500:(1.3167,0.01567,0.00899,-0.0647,0.0476,1.0000),
            9.750:(1.3326,0.01620,0.00949,-0.0629,0.0414,1.0000),
            10.000:(1.3472,0.01682,0.01007,-0.0609,0.0335,1.0000),
            10.250:(1.3592,0.01761,0.01080,-0.0587,0.0236,1.0000),
            10.500:(1.3730,0.01833,0.01150,-0.0568,0.0193,1.0000),
            10.750:(1.3881,0.01898,0.01217,-0.0552,0.0171,1.0000),
            11.000:(1.4035,0.01962,0.01284,-0.0536,0.0158,1.0000),
            11.250:(1.4179,0.02034,0.01359,-0.0520,0.0146,1.0000),
            11.500:(1.4330,0.02104,0.01432,-0.0506,0.0138,1.0000),
            11.750:(1.4479,0.02175,0.01507,-0.0492,0.0129,1.0000),
            12.000:(1.4615,0.02257,0.01593,-0.0477,0.0119,1.0000),
            12.250:(1.4742,0.02348,0.01687,-0.0462,0.0109,1.0000),
            12.500:(1.4872,0.02438,0.01781,-0.0448,0.0099,1.0000),
            12.750:(1.4988,0.02541,0.01887,-0.0434,0.0088,1.0000),
            13.000:(1.5096,0.02654,0.02002,-0.0420,0.0083,1.0000),
            13.250:(1.5198,0.02773,0.02125,-0.0406,0.0079,1.0000),
            13.500:(1.5295,0.02899,0.02256,-0.0393,0.0077,1.0000),
            13.750:(1.5386,0.03036,0.02398,-0.0380,0.0074,1.0000),
            14.000:(1.5468,0.03182,0.02550,-0.0368,0.0071,1.0000),
            14.250:(1.5543,0.03338,0.02713,-0.0357,0.0069,1.0000),
            14.500:(1.5611,0.03505,0.02886,-0.0346,0.0067,1.0000),
            14.750:(1.5686,0.03671,0.03059,-0.0337,0.0066,1.0000),
            15.000:(1.5750,0.03848,0.03244,-0.0328,0.0065,1.0000),
            15.250:(1.5805,0.04039,0.03442,-0.0320,0.0063,1.0000),
            15.500:(1.5852,0.04244,0.03656,-0.0312,0.0062,1.0000),
            15.750:(1.5889,0.04465,0.03885,-0.0306,0.0060,1.0000),
            16.000:(1.5915,0.04701,0.04129,-0.0300,0.0058,1.0000),
            16.250:(1.5931,0.04954,0.04391,-0.0296,0.0057,1.0000),
            16.500:(1.5934,0.05229,0.04674,-0.0292,0.0055,1.0000),
            16.750:(1.5924,0.05527,0.04981,-0.0290,0.0054,1.0000),
            17.000:(1.5899,0.05847,0.05310,-0.0289,0.0052,1.0000),
            17.250:(1.5853,0.06202,0.05674,-0.0290,0.0051,1.0000),
            17.500:(1.5790,0.06593,0.06075,-0.0293,0.0050,1.0000),
            17.750:(1.5765,0.06941,0.06433,-0.0297,0.0049,1.0000),
            18.000:(1.5732,0.07306,0.06808,-0.0302,0.0048,1.0000),
            18.250:(1.5679,0.07706,0.07219,-0.0309,0.0048,1.0000),
            18.500:(1.5617,0.08128,0.07650,-0.0318,0.0047,1.0000),
            18.750:(1.5542,0.08577,0.08111,-0.0329,0.0046,1.0000),
            19.000:(1.5451,0.09058,0.08603,-0.0342,0.0045,1.0000),
            19.250:(1.5352,0.09557,0.09112,-0.0356,0.0044,1.0000),
            },
        }

d_samples['Экранолёт с ядерным ПВРД'] = {
        'Масса аппарата (килограмм)':360000,
        # Энергия распада урана-235 с учётом осколков деления: 83,14 ТДж/кг
        # Топливо РБМК-1000, это около 200 тонн двуокиси урана (1.8-3% изотопа урана-235)
        # Стоимость топлива для РБМК-1000 — 1143 долларов/кг.
        # Стоимость оружейного, 90% урана — 40 000 долларов/кг
        'Запас энергии (мегаджоулей)':25*10**6,
        # Двигателю экранолёта нужны компрессоры, а то получается фигня:
        'Объём двигателя (кубометров)':2000,
        'Площадь воздухозаборников (квадратных метров)':20,
        'Предельная мощность (мегаватт)':400,
        'Размах крыла (метров)':102,
        'Хорда крыла (метров)':32,
        'Толщина крыла (метров)':10,
        'Несущая площадь крыла (квадратных метров)':2880,
        'Длина фюзеляжа (метров)':62,
        'Ширина фюзеляжа (метров)':40,
        'Высота фюзеляжа (метров)':10,
        'Горизонтальная площадь фюзеляжа (квадратных метров)':1240,
        'Коэффициент лобового сопротивления фюзеляжа':0.04,
        'Радиус колеса шасси (метров)':1,
        # Индуктивное сопротивление воздуха игнорирует:
        'Дисколёт':True,
        # http://airfoiltools.com/images/airfoil/davis-corrected-il_l.png
        # http://airfoiltools.com/airfoil/details?airfoil=davis-corrected-il
        # http://www.aviajournal.com/arhiv/2003/12/06.html
        'Поляра профиля крыла':{
            # Alpha,Cl,Cd
            0.0:(0.05,0.03),
            2.0:(0.1,0.04),
            4.0:(0.17,0.05),
            6.0:(0.3,0.06),
            8.0:(0.37,0.07),
            10.0:(0.42,0.08),
            12.0:(0.5,0.08),
            14.0:(0.58,0.09),
            16.0:(0.63,0.1),
            18.0:(0.7,0.12),
            20.0:(0.78,0.15),
            22.0:(0.79,0.2),
            24.0:(0.8,0.23),
            26.0:(0.81,0.26),
            28.0:(0.805,0.29),
            30.0:(0.8,0.32),
            },
        }


#d_samples['Пегас на контуре левитации'] = {
#        # https://en.wikipedia.org/wiki/Sack_AS-6
#        # https://en.wikipedia.org/wiki/Flying_Pancake
#        # http://www.airwar.ru/enc/glider/diskoplan2.html
#        # http://www.aviajournal.com/arhiv/2003/12/06.html
#        'Масса аппарата (килограмм)':70,
#        'Рабочее вещество ВРД (килограмм)':5,
#        'Скорость реактивной струи (метров/секунду)':437,
#        'Энергии на сжатие рабочего вещества (мегаджоулей)':1.3,
#        'Запас энергии (мегаджоулей)':45,
#        'Коэффициент лобового сопротивления':0.1,
#        'Площадь фронтальной проекции (квадратных метров)':2,
#        'Размах крыла (метров)':4,
#        'Хорда крыла (метров)':4,
#        'Несущая площадь крыла (квадратных метров)':12.6,
#        'Поляра профиля крыла':{
#            # http://airfoiltools.com/images/airfoil/davis-corrected-il_l.png
#            # http://airfoiltools.com/airfoil/details?airfoil=davis-corrected-il
#            # http://www.aviajournal.com/arhiv/2003/12/06.html
#            # Alpha,Cl,Cd
#            0.0:(0.05,0.03),
#            2.0:(0.1,0.04),
#            4.0:(0.17,0.05),
#            6.0:(0.3,0.06),
#            8.0:(0.37,0.07),
#            10.0:(0.42,0.08),
#            12.0:(0.5,0.08),
#            14.0:(0.58,0.09),
#            16.0:(0.63,0.1),
#            18.0:(0.7,0.12),
#            20.0:(0.78,0.15),
#            22.0:(0.79,0.2),
#            24.0:(0.8,0.23),
#            26.0:(0.81,0.26),
#            28.0:(0.805,0.29),
#            30.0:(0.8,0.32),
#            },
#        }
#
#d_samples['Единорожья левитирующая сфера'] = {
#        'Масса аппарата (килограмм)':0.3,
#        'Рабочее вещество ВРД (килограмм)':0.005,
#        'Скорость реактивной струи (метров/секунду)':437,
#        'Энергии на сжатие рабочего вещества (мегаджоулей)':0.0013,
#        'Запас энергии (мегаджоулей)':0.0014,
#        'Коэффициент лобового сопротивления':0.47,
#        'Площадь фронтальной проекции (квадратных метров)':0.03,
#        'Размах крыла (метров)':0.01,
#        'Хорда крыла (метров)':0.01,
#        'Несущая площадь крыла (квадратных метров)':0.03,
#        'Поляра профиля крыла':{
#            # http://airfoiltools.com/images/airfoil/davis-corrected-il_l.png
#            # http://airfoiltools.com/airfoil/details?airfoil=davis-corrected-il
#            # http://www.aviajournal.com/arhiv/2003/12/06.html
#            # Alpha,Cl,Cd
#            0.0:(0.05,0.03),
#            2.0:(0.1,0.04),
#            4.0:(0.17,0.05),
#            6.0:(0.3,0.06),
#            8.0:(0.37,0.07),
#            10.0:(0.42,0.08),
#            12.0:(0.5,0.08),
#            14.0:(0.58,0.09),
#            16.0:(0.63,0.1),
#            18.0:(0.7,0.12),
#            20.0:(0.78,0.15),
#            22.0:(0.79,0.2),
#            24.0:(0.8,0.23),
#            26.0:(0.81,0.26),
#            28.0:(0.805,0.29),
#            30.0:(0.8,0.32),
#            },
#        }

#-------------------------------------------------------------------------
# Функции интерфейса:

def create_parser():
    """Список доступных параметров скрипта."""
    parser = argparse.ArgumentParser()
    parser.add_argument('sample',
                        nargs='*',
                        help='Летательный аппарат (в "кавычках")'
                        )
    parser.add_argument('-a', '--angle',
                        action='store', dest='angle', type=float,
                        help='Угол атаки (0-20)'
                        )
    parser.add_argument('-s', '--speed',
                        action='store', dest='speed', type=int,
                        help='Постоянная скорость (км/час)'
                        )
    parser.add_argument('-S', '--seconds',
                        action='store', dest='seconds', type=int,
                        help='Число циклов модели (секунд)'
                        )
    parser.add_argument('-w', '--weight',
                        action='store', dest='weight', type=int,
                        help='Полезная нагрузка (кг)'
                        )
    parser.add_argument('-e', '--energy',
                        action='store_true', default='False',
                        help='Пополнение энергии в полёте'
                        )
    parser.add_argument('-m', '--model',
                        action='store_true', default='False',
                        help='Поиск оптимальных значений'
                        )
    return parser

def key_search (search_string, dict, silent=True):
    """Поиск нужного объекта в словаре, выбор по списку совпадений."""
    # Создаётся регистронезависимая поисковая строка:
    p = re.compile(search_string, re.I)
    # Создаём словарь совпадений:
    d_found = {}
    counter = 0
    # Поиск в словаре:
    for line in sorted(dict.keys()):
        line = str(line)
        if p.findall(line):
            d_found[counter] = line
            search_string = line
            counter = counter + 1
    # Если искомое не найдено, тогда выход:
    if not d_found:
        print(search_string)
        print('---Совпадений не найдено')
        exit(0)
    # Если найден один варинт, тогда его и выбираем:
    elif len(d_found) == 1:
        sample = d_found[0]
    elif silent is True:
        search_string = d_found[0]
        sample = search_string
    # Если несколько совпадений, тогда выбор по номеру:
    else:
        for key in d_found:
            print(key,d_found[key])
        string_number = input('---Найдено несколько совпадений (введите номер): ')
        search_string = d_found[int(string_number)]
        sample = search_string
        print('-----------------------------------------------------')
    return sample

#-------------------------------------------------------------------------
# Функции скрипта:

def f_take_closest(number,collection):
    """Поиск ближайшего числа в списке"""
    return min(collection,key=lambda x:abs(x-number))

def f_triangle (side_b, angle_a, angle_b):
    """Сторона треугольника по двум углам и другой стороне.

    Теорема синусов:
    # http://www-formula.ru/lengthpartiestriangle
    a = (b * sin(α))/sin(β)
    Где:
    b - известная сторона
    α - угол противолежащий от стороны a и прилежащий к стороне b.
    β - угол противолежащий от стороны b и прилежащий к стороне a.
    """
    # math.sin ждёт угла в радианах, поэтому преобразуем градусы с помощью math.radians
    side_a = abs(side_b * math.sin(math.radians(angle_a))) / math.sin(math.radians(angle_b))
    return side_a

def f_projection_square(angle):
    """Площадь проекции летательного аппарата.

    Летательный аппарат представляется как цилиндр с крыльями.
    По теореме синусов находится удлинение сторон, вычисляется площадь.
    При угле 0° это фронтальная площадь, при угле 90° горизонтальная.
    """
    if WINGSPAN * f_triangle(WING_WIDTH, angle, 90) > WING_FRONT_SQUARE:
        # Для многопланов первое крыло при сваливании пробивает в воздухе туннель.
        wing_square = WINGSPAN * f_triangle(WING_WIDTH, angle, 90)
        test_body_square = BODY_WIDTH * f_triangle(BODY_LENGTH, angle, 90)
        if test_body_square > BODY_FRONT_SQUARE:
            body_square = test_body_square
        else:
            body_square = BODY_FRONT_SQUARE
    else:
        wing_square = WING_FRONT_SQUARE
        body_square = BODY_FRONT_SQUARE
    total_square = wing_square + body_square
    return wing_square, body_square, total_square

def f_body_drag (angle_of_attack):
    """Аэродинамический коэффициент фюзеляжа зависит от угла атаки.
    
    Коэффициент равен фронтальному при угле атаки до ±20°
    Но при закритических углах растёт, пока не достигнет предела на 90°
    """
    angle_body_square = \
            f_projection_square(angle_of_attack)[1]
    horizonal_body_square = BODY_BOTTOM_SQUARE
    body_square_percent = angle_body_square / horizonal_body_square
    body_drag = HORIZONTAL_BODY_DRAG_COEFFICIENT * body_square_percent
    if body_drag < FRONTAL_BODY_DRAG:
        body_drag = FRONTAL_BODY_DRAG
    return body_drag

def f_drag_force (aerodynamic_coefficient, air_density, velocity, aerodynamic_square):
    """Аэродинамическое сопротивление.

    X=Ca*((p*V^2)/2)*S
    X — сопротивление в Ньютонах
    Cx — коэффициент аэродинамического сопротивления (0.04 для крыла)
    Cy - коэффициент подъёмной силы (зависит от угла атаки 5°=0.4, 9°=0.8, 15°=1.2)
    p — плотность воздуха в кг/м³ (1.2 при 20°C)
    V — скорость в м/с (50 м/с из прошлой формулы)
    S — площадь поперечного сечения (2 м²)
    """
    drag_force = aerodynamic_coefficient * ((air_density * velocity ** 2) / 2) * aerodynamic_square
    return drag_force

def f_reynolds_number (aircraft_speed, wing_width):
    """Число Рейнольдса. Под него выбираем поляру крыла.
    
    Формула:
    Re = (V * L) / (n / p)
    Где:
    V - скрость м/с
    L - хорда крыла
    n - динамическая вязкость воздуха (0.000018 Па*с при 20 °C)
    p - плотность воздуха (1.2 на уровне земли)
    Пример:
    ((100/3.6) * 0.35) / (0.000018 / 1.2) = 648 148
    """
    air_kinematic_viscosity = AIR_DYNAMIC_VISCOSITY / AIR_DENSITY
    reynolds_number = (aircraft_speed * wing_width) / air_kinematic_viscosity
    return reynolds_number

def f_wing_aspect_ratio (wingspan, wing_square):
    """Геометрическое удлинение крыла.
    
    L = l/b = l^2/S
    Где:
    l - размах крыла (длина прямой между крайними точками)
    b - средняя хорда крыла
    S - площадь крыла в м²
    """
    # Эта формула подходит только для прямых крыльев:
    wing_aspect_ratio = WINGSPAN / WING_WIDTH
    # А эта не работает для бипланов/трипланов:
    #wing_aspect_ratio = WINGSPAN ** 2 / WING_SQUARE
    return wing_aspect_ratio

def f_lift_induced_drag (wing_lift_coefficient, wing_aspect_ratio):
    """Индуктивное лобовое сопротивление.

    Формула индуктивного сопротивления:
    Cxi = Cy/(1.4*L)
    Где:
    Cxi - коэффициент индуктивного сопротивления
    Cy - коэффициент подъёмной силы (зависит от угла атаки 5°=0.4, 9°=0.8, 15°=1.2)
    L - геометрическое удлинение крыла (6.4)
    """
    lift_induced_drag = abs(wing_lift_coefficient / (1.4 * wing_aspect_ratio))
    return lift_induced_drag

def f_aerodynamic (angle_of_attack):
    """Аэродинамические показатели меняются со сменой угла атаки.
    
    Угол атаки 0° — горизонтально, 90° — вертикально вверх, -90° — вертикально вниз.
    1) Площадь фронтальной проекции зависит от наклона.
    2) Коэффициенты подъёмной силы и сопротивления крыла берутся из поляры.
    2) Коэффициент индуктивного сопротивления зависит от размаха и площади крыла.
    """
    # Проверка угла атаки:
    if angle_of_attack > 90 or angle_of_attack < -90:
        print('Недопустимый угол атаки:', angle_of_attack)
        print('Диапазон от -90 до 90, где 0, это вектор скорости')
        exit()
    # Площадь проекции самолёта:
    wing_square, body_square, total_square = \
            f_projection_square(angle_of_attack)
    # Коэффициенты подъёмной силы и лобового сопротивления крыла берём из таблицы: 
    wing_lift_coefficient = d_polar.get(angle_of_attack)[0]
    wing_drag_coefficient = d_polar.get(angle_of_attack)[1]
    # Сопротивление фюзеляжа равно фронтальному, или приблизительно вычисляется для закритических углов:
    body_drag = f_body_drag(angle_of_attack)
    # Вычисляем общий коэффициент лобового сопротивления:
    wing_square_percent = wing_square / total_square
    body_square_percent = body_square / total_square
    form_drag = wing_drag_coefficient * wing_square_percent + \
            body_drag * body_square_percent
    # Считаем коэффициент индуктивного сопротивления (для дисколёта он значительной снижается):
    if DISK_WING is False:
        lift_induced_drag = f_lift_induced_drag(wing_lift_coefficient,
                f_wing_aspect_ratio(WINGSPAN, WING_SQUARE))
        # Коэффициент общего лобового сопротивления:
        total_drag = form_drag + lift_induced_drag
    else:
        total_drag = form_drag
    aerodynamic_output = (total_square, wing_square, wing_lift_coefficient, total_drag)
    return aerodynamic_output

def f_create_dict_plane (angle_of_attack):
    """Аэродинамические показатели для фронтальной и горизонтальной проекции."""
    frontal_aerodynamics = f_aerodynamic(angle_of_attack)
    horizontal_projection_angle = f_take_closest(90 - angle_of_attack, d_polar.keys())
    horizonal_aerodynamics = f_aerodynamic(horizontal_projection_angle)
    d_plane = {
            'total_front_square':frontal_aerodynamics[0],
            'wing_front_square':frontal_aerodynamics[1],
            'wing_lift_coefficient':frontal_aerodynamics[2],
            'total_front_drag':frontal_aerodynamics[3],
            'total_bottom_square':horizonal_aerodynamics[0],
            'wing_bottom_square':horizonal_aerodynamics[1],
            'total_bottom_drag':horizonal_aerodynamics[3],
            }
    return d_plane

def f_heated_gas_pressure (heat):
    """Уравнение состояния идеального газа.
    
    p=((m/M)*R*T)/V
    Где:
    p — Давление (в Паскалях).
    m — масса (1.2 кг).
    M — Молярная масса (для воздуха 0.029 кг/моль)
    R — Универсальная газовая постоянная (8.3145 Дж/(моль*К)
    T — Абсолютная температура (581 кельвин = 314 °C).
    V — Объём (1 м³).

    Газ расширяется при нагревании:
    ((1.2/0.02898)*8.3145*581)/1=200030
    """
    heated_gas_pressure = ((AIR_DENSITY / AIR_MOLAR_MASS) * GAS_CONSTANT * heat) / 1
    return heated_gas_pressure

def f_de_laval_nozzle (engine_air_heat, engine_air_pressure, atmospheric_pressure):
    """Формула сопла Лаваля определяет скорость реактивной струи по сжатию и нагреву рабочего вещества:
    
    Формула сопла Лаваля:
    https://ru.wikipedia.org/wiki/Сопло_Лаваля
    V=sqrt((T*R/M)*(2*k/(k-1))*[1-(Pe/p)^((k-1)/k)])
    Где:
    sqrt( ) — квадратный корень.
    V — Скорость газа на выходе из сопла, м/с
    T — Абсолютная температура газа на входе (в кельвинах). Возьмём 539 Кельвинов (267°C).
    R — Универсальная газовая постоянная (8.3145 Дж/(моль*К)
    M — Молярная масса газа, кг/киломоль (для воздуха 0.029 кг/моль)
    k — Показатель адиабаты (для сухого воздуха при 20°C — 1.4)
    [ ] — модуль
    Pe — Давление газа на выходе из сопла (в Паскалях). Атмосферное давление — 101 325 Паскалей.
    P — Давление газа на входе в сопло. Возьмём 2 Бара (200 000 Паскалей).

    Пример:
    math.sqrt((539 * 8.3144598 / 0.029) * (2 * 1.4 / (1.4 - 1)) * math.fabs(1 - (101325 / 200000) ** ((1.4 - 1) / 1.4)))
    При температуре сжатого воздуха 267°С и сжатии в 2 Бара скорость струи — 437 м/с.
    Для сравнения: скорость звука — 340.29 м/с
    """
    reactive_speed = math.sqrt((engine_air_heat * GAS_CONSTANT / AIR_MOLAR_MASS) * \
            (2 * AIR_HEAT_CAPACITY_RATIO / (AIR_HEAT_CAPACITY_RATIO - 1)) * \
            math.fabs(1 - (atmospheric_pressure / engine_air_pressure) ** \
            ((AIR_HEAT_CAPACITY_RATIO - 1) / AIR_HEAT_CAPACITY_RATIO)))
    return reactive_speed

def f_jet_force (working_mass, reactive_speed):
    """Тяга летательного аппарата."""
    max_engine_thrust = working_mass * reactive_speed
    return max_engine_thrust

def f_airflow (aircraft_speed):
    """Объём воздуха, через который проходят крылья пегаса за секунду.
    
    Часть из этого воздуха использует воздушно-реактивный двигатель.
    А также из воздуха пони собирают энергию для полёта.
    """
    air_volume = abs(aircraft_speed) * AIRFLOW_INTAKES
    return air_volume

def f_engine (air_volume, energy_MJ):
    """Прямоточный воздушно реактивный двигатель.
    
    Набегающий поток воздуха попадает в нагреватель, где расширяется,
    А затем выбрасывается из сопла реактивной струёй.
    """
    # Рабочее вещество, это атмосферный воздух:
    working_mass = air_volume * AIR_DENSITY
    # Делим энергию на полезную и бесполезную:
    useful_energy_MJ = energy_MJ * ENGINE_USEFUL_ENERGY
    useless_energy_MJ = energy_MJ - useful_energy_MJ
    useful_energy_KJ = useful_energy_MJ * 1000
    # Полезную энергию пускаем на разогрев воздуха:
    working_mass_heat = AIR_HEAT_CAPACITY * useful_energy_KJ / working_mass
    # Делаем поправку на температуру воздуха и переводим градусы в шкалу Кельвина:
    working_mass_heat = AIR_TEMPERATURE + working_mass_heat + KELVIN_SCALE
    # Давление разогретого воздуха увеличивается:
    working_mass_pressure = f_heated_gas_pressure(working_mass_heat)
    # Воздух подаётся на сопло Лаваля, так мы получаем скорость реактивной струи:
    reactive_speed = f_de_laval_nozzle(working_mass_heat,
            working_mass_pressure, ATMOSPHERIC_PRESSURE)
    # Максимальная тяга, это масса рабочего вещества умноженная на его скорость:
    max_engine_thrust = f_jet_force(working_mass, reactive_speed)
    # Бесполезную тепловую энергию тоже требуется куда-то отводить:
    engine_output = (max_engine_thrust, working_mass, reactive_speed, useless_energy_MJ)
    return engine_output

def f_engine_control (engine_mode, air_volume=START_AIR_VOLUME):
    """Режимы работы двигателя."""
    # Аслоу, эта функция должна следить за временем.
    # А нужно ли это? Нужно, чтобы определить тягу под каждый режим, а потом пользоваться как таблицей.
    # Тогда понадобится и воздушный поток брать, и поверхность крыльев. Модель в модели, зачем она?
    energy_unit = WINGPOWER
    working_mass_energy = WORKING_MASS_ENERGY_MJ
    energy_scale = working_mass_energy  / energy_unit
    d_engine = {
            'dash':(energy_scale, working_mass_energy),
            'maximal':(energy_scale / 2, working_mass_energy / 2),
            'nominal':(energy_scale / 4, working_mass_energy / 4),
            'cruising':(energy_scale / 8, working_mass_energy / 8),
            'minimal':(energy_scale / 16, working_mass_energy / 16),
            'shy':(energy_scale / 32, working_mass_energy / 32),
            }
    # Привяжи тогда уж контрольную панель к самому двигателю:
    engine_output = f_engine(air_volume, d_engine[engine_mode][1])
    engine_required_energy = d_engine[engine_mode][1]
    engine_thrust = engine_output[0]
    engine_overheating = engine_output[3]
    # Можно добавить систему охлаждения и ограничение на длительность форсажа.
    return engine_thrust, engine_required_energy, engine_overheating

def f_engine_mode_choice (required_thrust, engine_air_volume):
    """Выбор режима двигателя. Тупым перебором."""
    engine_modes = ['shy', 'minimal', 'cruising', 'nominal', 'maximal', 'dash']
    optimal_mode = None
    for mode in engine_modes:
        engine_thrust, engine_required_energy, engine_overheating = \
                f_engine_control(mode, engine_air_volume)
        if engine_thrust > required_thrust:
            optimal_mode = engine_thrust, engine_required_energy, engine_overheating, mode
            break
    # Если ни один режим не даёт достаточной тяги, тогда всё равно выбираем форсаж:
    if optimal_mode is None:
        mode = 'dash'
        engine_thrust, engine_required_energy, engine_overheating = \
                f_engine_control(mode, engine_air_volume)
        optimal_mode = engine_thrust, engine_required_energy, engine_overheating, mode
    return optimal_mode

def f_rolling (engine_thrust, d_plane, d_flight):
    """Качение по взлётной полосе.

    Подъёмной силы недостаточно для взлёта, хотя вес и уменьшается.
    Замедление из-за лобового сопротивления и силы трения качения.

    Формула силы трения качения:
    Fтр=kтр(Fn/r)
    Где:
    kтр- коэффициент трения
    Fn - прижимающая сила
    r - радиус колеса."""
    # Ускоряем самолёт:
    jet_acceleration = engine_thrust / d_flight['aircraft_mass']
    aircraft_speed = d_flight['aircraft_speed'] + jet_acceleration
    # Система сил (полезные с плюсами, противостоящие с минусами):
    jet_force = engine_thrust
    drag_force = -(f_drag_force(
            d_plane['total_front_drag'], AIR_DENSITY,
            aircraft_speed, d_plane['total_front_square']
            ))
    lift_force = f_drag_force(
            d_plane['wing_lift_coefficient'], AIR_DENSITY,
            aircraft_speed, WING_SQUARE
            )
    grav_force = -(d_flight['aircraft_mass'] * GRAVITATIONAL_ACCELERATION)
    # Прижимающая сила:
    normal_force = grav_force + lift_force
    # Работает сила трения качения (поскольку копыта считать лень):
    friction_force = ROLLING_RESISTANCE_COEFFICIENT * \
            (normal_force / WHEEL_RADIUS)
    # Качение по взлётной полосе:
    if jet_force >= 0 \
            and drag_force <= 0 \
            and friction_force <= 0 \
            and lift_force < abs(grav_force):
        drag_deceleration = drag_force / aircraft_mass
        friction_deceleration = friction_force / aircraft_mass
        # Замедляем самолёт:
        aircraft_speed = aircraft_speed + friction_deceleration + drag_deceleration
        climb_speed = 0
        climb_rate = 0
        return aircraft_speed, climb_speed, climb_rate
    # Отрыв от земли, Переход на функцию climbing:
    elif jet_force >= 0 \
            and drag_force <= 0 \
            or friction_force >= 0 \
            or lift_force > abs(grav_force):
        return f_climbing(engine_thrust, d_plane, d_flight)
    else:
        print('Что-то пошло не так, f_rolling')
        print(jet_force, drag_force, friction_force,
                lift_force, normal_force, grav_force)
        exit()

def f_climbing (engine_thrust, d_plane, d_flight):
    """Набор высоты за счёт подъёмной силы и угла вектора скорости.
    
    Чем выше подъёмная сила, тем с большей скоростью пегаса тащит вверх.
    Также набранная высота повышается из-за вектора скорости к горизонту.
    """
    # Ускоряем самолёт:
    jet_acceleration = engine_thrust / d_flight['aircraft_mass']
    aircraft_speed = d_flight['aircraft_speed'] + jet_acceleration
    # Система сил (полезные с плюсами, противостоящие с минусами):
    jet_force = engine_thrust
    drag_force = -(f_drag_force(
            d_plane['total_front_drag'], AIR_DENSITY,
            aircraft_speed, d_plane['total_front_square']
            ))
    lift_force = f_drag_force(
            d_plane['wing_lift_coefficient'], AIR_DENSITY,
            aircraft_speed, WING_SQUARE
            )
    grav_force = -(d_flight['aircraft_mass'] * GRAVITATIONAL_ACCELERATION)
    # Подъёмная сила может быть как положительной так и отрицательной:
    climb_force = lift_force + grav_force
    climb_acceleration = climb_force / aircraft_mass
    climb_speed = d_flight['climb_speed'] + climb_acceleration
    # Сопротивление воздуха мешает вертикальному подъёму или сваливанию:
    horizontal_drag_force = -(f_drag_force(
            d_plane['total_bottom_drag'], AIR_DENSITY,
            climb_speed, d_plane['total_bottom_square']
            ))
    # Набор высоты:
    if jet_force >= 0 \
            and lift_force >= 0 \
            and drag_force <= 0 \
            and horizontal_drag_force <= 0:
        drag_deceleration = drag_force / aircraft_mass
        horizontal_drag_deceleration = horizontal_drag_force / aircraft_mass
        # Замедляем самолёт:
        aircraft_speed = aircraft_speed + drag_deceleration
        if climb_speed > 0:
            # Скорость плюсовая, набор высоты и замедление:
            climb_speed = climb_speed + horizontal_drag_deceleration
            # Костыли-костылики. Но кот знает, как иначе этот маятник исправить:
            if climb_speed < 0:
                climb_speed = 0
        else:
            # Скорость минусовая, сваливание и замедление сваливания:
            climb_speed = climb_speed - horizontal_drag_deceleration
            if climb_speed > 0:
                climb_speed = 0
        # Также на высоту работает направление вектора скорости:
        climb_rate = climb_speed + \
                f_triangle(aircraft_speed, d_flight['angle_of_attack'], 90)
        return aircraft_speed, climb_speed, climb_rate
    else:
        print('Что-то пошло не так, f_climbing')
        print(jet_force, drag_force, horizontal_drag_force,
                lift_force, grav_force)
        exit()

def f_gliding (engine_thrust, d_plane, d_flight):
    """Планирование.
    
    Угол атаки отрицательный, но подъёмная сила поддерживает аппарат.
    Вектор прижимающей силы незначительно отклоняется вперёд.
    Доля прижимающей силы (синус угла атаки) переходит в силу тяги.
    Аппарат компенсирует лобовое сопротивление за счёт медленного снижения.
    """
    angle_of_attack = d_flight['angle_of_attack']
    # Ускоряем самолёт:
    jet_acceleration = engine_thrust / d_flight['aircraft_mass']
    aircraft_speed = d_flight['aircraft_speed'] + jet_acceleration
    # Система сил (полезные с плюсами, противостоящие с минусами):
    jet_force = engine_thrust
    drag_force = -(f_drag_force(
            d_plane['total_front_drag'], AIR_DENSITY,
            aircraft_speed, d_plane['total_front_square']
            ))
    lift_force = f_drag_force(
            d_plane['wing_lift_coefficient'], AIR_DENSITY,
            aircraft_speed, WING_SQUARE
            )
    grav_force = -(d_flight['aircraft_mass'] * GRAVITATIONAL_ACCELERATION)
    # Вектор прижимаюещей силы направлен вперёд, поэтому часть её переходит в тягу.
    # Поскольку пикирование не допилено, lift_force крыла и антикрыла считаются одинаково положительными:
    incline_force = abs(lift_force * math.sin(math.radians(angle_of_attack)))
    # Подъёмная сила может быть как положительной так и отрицательной:
    climb_force = lift_force + grav_force
    climb_acceleration = climb_force / aircraft_mass
    climb_speed = d_flight['climb_speed'] + climb_acceleration
    # Сопротивление воздуха мешает вертикальному подъёму или сваливанию:
    horizontal_drag_force = -(f_drag_force(
            d_plane['total_bottom_drag'], AIR_DENSITY,
            climb_speed, d_plane['total_bottom_square']
            ))
    # Планирование:
    if jet_force >= 0 \
            and incline_force >= 0 \
            and drag_force <= 0 \
            and horizontal_drag_force <= 0:
        incline_acceleration = incline_force / aircraft_mass
        drag_deceleration = drag_force / aircraft_mass
        horizontal_drag_deceleration = horizontal_drag_force / aircraft_mass
        # Замедляем самолёт, или ускоряем его:
        aircraft_speed = aircraft_speed + incline_acceleration + drag_deceleration
        if climb_speed > 0:
            # Скорость плюсовая, набор высоты и замедление:
            climb_speed = climb_speed + horizontal_drag_deceleration
            if climb_speed < 0:
                climb_speed = 0
        else:
            # Скорость минусовая, сваливание и замедление сваливания:
            climb_speed = climb_speed - horizontal_drag_deceleration
            if climb_speed > 0:
                climb_speed = 0
        # Плата за планирование -- снижение под небольшим углом:
        descent_rate = climb_speed - f_triangle(aircraft_speed, angle_of_attack, 90)
        return aircraft_speed, climb_speed, descent_rate
    # Пикирование:
    #elif jet_force >= 0 \
    #        and incline_force >= 0 \
    #        and lift_force <= 0 \
    #        and drag_force <= 0 \
    #        and horizontal_drag_force <= 0:
    #    pass
    else:
        print('Что-то пошло не так, f_gliding')
        print(jet_force, incline_force, drag_force,
                horizontal_drag_force, lift_force, grav_force)
        exit()

# Пикирование. Нужно целиком переписать.
#def f_diving (grav_force, lift_force, drag_force,
#        aircraft_mass, aircraft_speed, angle_of_attack, climb_speed):
#    """Пикирование.
#
#    Угол атаки отрицательный, подъёмная сила превращается в силу антикрыла.
#    По этой же причине вектор прижимающей силы отклоняется вперёд.
#    Доля прижимающей силы (синус угла атаки) переходит в силу тяги.
#    Аппарат платит набранной высотой за быстрое повышение скорости.
#    """
#    descent_force = -grav_force + lift_force
#    descent_acceleration = descent_force / aircraft_mass
#    # Скорость снижения минусовая:
#    descent_speed = climb_speed + descent_acceleration
#    print('climb_speed',descent_speed, descent_force)
#    # Крыло скользит по воздуху под углом, поэтому вектор силы реакции опоры отклоняется вперёд.
#    # Часть силы притяжения и давления воздуха на крыло переходит в силу тяги:
#    incline_force = abs(descent_force * math.sin(math.radians(angle_of_attack)))
#    incline_force = incline_force - drag_force
#    incline_acceleration = incline_force / aircraft_mass
#    aircraft_speed = aircraft_speed + incline_acceleration
#    #print(descent_force,incline_force,descent_acceleration,incline_acceleration)
#    # Вектор скорости летательного аппарата направлен под углом к земле:
#    descent_rate = descent_speed + f_triangle(aircraft_speed, angle_of_attack, 90)
#    return aircraft_speed, descent_speed, descent_rate

def f_glide_model (d_flight, d_LD_ratio, silent=False, energy_collect=False):
    """Модель взлёта, полёта и планирования.
    
    1) В первом словаре модель получает данные для полёта:
    Массу аппарата, начальную скорость и высоту, запас энергии.
    2) Во втором словаре данные аэродинамического качества углов атаки:
    Используя эти сведения автопилот выбирает для полёта оптимальные углы.
    3) Затем вычисляются аэродинамические коэффициенты и площади проекций:
    Как фронтальной, так и горизонтальной (для расчёта взлёта/сваливания)
    4) В зависимости от высоты и угла атаки выбирается одна из функций:
    Разгон по взлётной полосе, набор высоты, планирование.
    5) Полётные данные пополняются и снова передаются автопилоту.
    6) Модель работает с ограничением по времени или до приземления.
    """
    d_flight_log = {}
    d_plane = f_create_dict_plane(d_flight['angle_of_attack'])
    while d_flight['altitude'] >=0 and d_flight['second'] <= max_seconds:
        # Автопилот выбирает угол атаки и режим двигателя:
        optimum_angle, engine_thrust, engine_required_energy = \
                f_pegasus_mind(d_flight, d_plane, d_LD_ratio)
        # Если энергия закончилась, никто никуда не летит:
        if d_flight['energy_balance'] < engine_required_energy:
            print(engine_required_energy)
            print(d_flight['energy_balance'])
            engine_required_energy = 0
            engine_thrust = 0
        # Если угол изменился пересчитываются аэродинамические качества аппарата:
        if optimum_angle != d_flight['angle_of_attack']:
            d_plane = f_create_dict_plane(optimum_angle)
            d_flight['angle_of_attack'] = optimum_angle
        # Качение по земле:
        if d_flight['altitude'] == 0 and d_flight['climb_speed'] == 0:
            aircraft_speed, climb_speed, climb_rate = \
                    f_rolling(engine_thrust, d_plane, d_flight)
            distance = aircraft_speed
        # Набор высоты:
        elif d_flight['angle_of_attack'] > 0 \
                and d_flight['altitude'] > 0:
            aircraft_speed, climb_speed, climb_rate = \
                    f_climbing(engine_thrust, d_plane, d_flight)
            # Скорость, это векторная величина,
            # А расстояние по горизонтали -- соседняя сторона треугольника:
            distance = f_triangle(aircraft_speed, 90 - angle_of_attack, 90)
        # Планирование:
        elif d_flight['angle_of_attack'] < 0 \
                and d_flight['altitude'] > 0:
            aircraft_speed, climb_speed, climb_rate = \
                    f_gliding(engine_thrust, d_plane, d_flight)
            # Скорость, это векторная величина,
            # А расстояние по горизонтали -- соседняя сторона треугольника:
            distance = f_triangle(aircraft_speed, 90 - abs(angle_of_attack), 90)
        # Пикирование:
            # Нужно переписать.
        else:
            print('Что-то пошло не так. glide_model')
            exit()
        # Вычисляем объём рабочего вещества для ВРД и пополнение энергии:
        engine_air_volume = f_airflow(aircraft_speed)
        if energy_collect is True:
            energy_collection = engine_air_volume * AIR_MAGIC_ENERGY_MJ
            d_flight['energy_balance'] += energy_collection
        # Дополняем словарь:
        d_flight['aircraft_speed'] = aircraft_speed
        d_flight['climb_speed'] = climb_speed
        d_flight['engine_air_volume'] = engine_air_volume
        d_flight['energy_balance'] -= engine_required_energy
        d_flight['altitude'] += climb_rate
        d_flight['path'] += distance
        d_flight['second'] += 1
        # Запись лога:
        d_flight_log[d_flight['second']] = d_flight
        if silent is not True:
            print(d_flight['second'], round(d_flight['aircraft_speed']),
                    round(d_flight['path']), round(d_flight['altitude']),
                    round(engine_thrust / 9.8), 'кгс',
                    round(engine_required_energy * 1000), 'кВт')
    return d_flight_log
        
def f_lift_to_drag_ratio (d_polar):
    """Аэродинамическое качество, это Cy/Cx (Cl/Cd)
    
    Следует заметить, что при этом нас интересует не Cl/Cd крыла,
    А тот же показатель для всего аппарата.
    """
    d_LD_ratio = {}
    for key in d_polar:
        Cl = d_polar[key][0]
        total_drag = f_aerodynamic(key)[3]
        LD_ratio = Cl / total_drag
        d_LD_ratio[key] = LD_ratio
    return d_LD_ratio

def f_acceleration_estimate (speed, distance):
    """Определяем необходимое ускорение по конечной скорости и дистанции
    
    Формула для определения пути без знания времени:
    S = (V ** 2 - V0 ** 2) / 2 * a
    Где:
    S - расстояние
    V - скорость
    V0 - начальная скорость
    a - ускорение

    Выведенная формула:
    a = (V ** 2) / S / 2
    Где:
    V - скорость
    S - расстояние
    a - ускорение
    """
    acceleration = (speed ** 2) / distance / 2
    return acceleration

def f_autopilot_takeoff (d_flight, d_LD_ratio, aircraft_mass, energy_balance):
    """Процедура взлёта.

    1) Автопилот выбирает оптимальный угол атаки по аэродинамическому качеству.
    2) Выбирается взлётная скорость по углу атаки и весу аппарата.
    3) Выбирается ускорение, ограниченное длиной взлётной полосы.
    4) По ускорению и аэродинамическому качеству определяется необходимая тяга.
    5) Наконец, выбирается оптимальный режим двигателя (простым перебором).
    """
    engine_air_volume = d_flight['engine_air_volume']
    aircraft_speed = d_flight['aircraft_speed']
    optimum_angle = max(d_LD_ratio.keys(), key=(lambda k: d_LD_ratio[k]))
    optimum_speed = f_find_optimum_speed_for_angle(aircraft_mass, optimum_angle)
    optimum_acceleration = f_acceleration_estimate(optimum_speed, RUNWAY_LENGTH)
    optimum_trust = optimum_acceleration * aircraft_mass
    # Вычислем необходимую тягу через коэффициент аэродинамического качества:
    required_thrust = (aircraft_mass * GRAVITATIONAL_ACCELERATION) / d_LD_ratio[optimum_angle]
    # КПД понячьего двигателя зависит от скорости, лучше взять максимальное ускорение в начале:
    if engine_air_volume == 0:
        engine_mode = 'maximal'
        engine_thrust, engine_required_energy, engine_overheating = \
                f_engine_control(engine_mode, START_AIR_VOLUME)
        return optimum_angle, engine_thrust, engine_required_energy
    # Если взлётная полоса достаточно длинная, не мучаем двигатель:
    elif required_thrust > optimum_trust:
        engine_thrust, engine_required_energy, engine_overheating, engine_mode = \
                f_engine_mode_choice (required_thrust, engine_air_volume)
        #print(engine_mode)
        return optimum_angle, engine_thrust, engine_required_energy
    # Если длина взлётной полосы недостаточна, увеличиваем тягу:
    elif required_thrust < optimum_trust:
        required_thrust = optimum_trust
        engine_thrust, engine_required_energy, engine_overheating, engine_mode = \
                f_engine_mode_choice (required_thrust, engine_air_volume)
        #print(engine_mode)
        return optimum_angle, engine_thrust, engine_required_energy
    else:
        #print('Что-то пошло не так. f_autopilot_takeoff:')
        return optimum_angle, 0, 0

def f_pegasus_mind (d_flight, d_plane, d_LD_ratio):
    # Переписывай, словарик лучше кучи переменных. Записи лишь чуть длиннее, зато всё сгруппировано.
    # Потихоньку пишем пегасий ИИ. Он должен передавать команды крыльям и движку.
    energy_balance = d_flight['energy_balance']
    aircraft_mass = d_flight['aircraft_mass']
    engine_air_volume = d_flight['engine_air_volume']
    aircraft_speed = d_flight['aircraft_speed']
    climb_speed = d_flight['climb_speed']
    second = d_flight['second']
    path = d_flight['path']
    altitude = d_flight['altitude']
    #print(aircraft_speed, path, altitude)
    # Взлёт:
    if altitude == 0:
        optimum_angle, engine_thrust, engine_required_energy = \
                f_autopilot_takeoff(d_flight, d_LD_ratio, aircraft_mass, energy_balance)
        return optimum_angle, engine_thrust, engine_required_energy
    # Полёт с набором высоты:
    elif 0 < altitude < MIN_ALTITUDE \
            and d_flight['energy_balance'] > ENERGY_BALANCE_MJ / 10:
        # А вот и нет, здесь оптимальный угол уже ищется по лобовому сопротивлению.
        # Но сразу не выбирается, чтобы подъёмная сила не упала.
        optimum_angle = max(d_LD_ratio.keys(), key=(lambda k: d_LD_ratio[k]))
        optimum_speed = f_find_optimum_speed_for_angle(aircraft_mass, optimum_angle)
        if aircraft_speed < optimum_speed:
            required_thrust = (aircraft_mass * GRAVITATIONAL_ACCELERATION) / d_LD_ratio[optimum_angle]
            engine_thrust, engine_required_energy, engine_overheating, engine_mode = \
                    f_engine_mode_choice (required_thrust, engine_air_volume)
            #print(engine_mode)
            return optimum_angle, engine_thrust, engine_required_energy
        if aircraft_speed >= optimum_speed:
            #print('off')
            return optimum_angle, 0, 0
    # Набор скорости и безумные эксперименты:
    elif MIN_ALTITUDE < altitude < MAX_ALTITUDE \
            and d_flight['energy_balance'] > ENERGY_BALANCE_MJ / 10:
        if fixed_angle:
            optimum_angle = fixed_angle
        else:
            optimum_angle = max(d_LD_ratio.keys(), key=(lambda k: d_LD_ratio[k]))
        optimum_speed = f_find_optimum_speed_for_angle(aircraft_mass, optimum_angle)
        if aircraft_speed < optimum_speed:
            required_thrust = (aircraft_mass * GRAVITATIONAL_ACCELERATION) / d_LD_ratio[optimum_angle]
            engine_thrust, engine_required_energy, engine_overheating, engine_mode = \
                    f_engine_mode_choice (required_thrust, engine_air_volume)
            return optimum_angle, engine_thrust, engine_required_energy
        elif fixed_speed and aircraft_speed < fixed_speed:
            required_thrust = f_drag_force(
            d_plane['total_front_drag'], AIR_DENSITY,
            fixed_speed, d_plane['total_front_square'])
            engine_thrust, engine_required_energy, engine_overheating, engine_mode = \
                    f_engine_mode_choice (required_thrust, engine_air_volume)
            #print(engine_mode, engine_thrust)
            return optimum_angle, engine_thrust, engine_required_energy
        elif aircraft_speed >= optimum_speed:
            #print('off')
            return optimum_angle, 0, 0
    # Планирование
    elif d_flight['energy_balance'] < ENERGY_BALANCE_MJ / 10:
        optimum_angle = f_take_closest(-5, d_polar.keys())
        return optimum_angle, 0, 0
    else:
        optimum_angle = f_take_closest(-3, d_polar.keys())
        #print('Автопилот не умеет летать.')
        return optimum_angle, 0, 0



def f_flight_model (speed):
    """Модель полёта с постоянной скоростью."""
    # Старая глупая модель. Перепели её!
    # Аэродинамические свойства зависят от угла атаки:
    total_front_square, wing_front_square, \
            wing_lift_coefficient, total_drag = f_aerodynamic(angle_of_attack)
    speed_kilometre_hour = speed
    speed_metre_second = speed / 3.6
    aircraft_speed = speed_metre_second
    second = 1
    path = 0
    altitude = 0
    engine_cycles = 1
    # Возможности двигателя:
    max_engine_thrust, working_mass, reactive_speed = f_engine(AIR_VOLUME, WORKING_MASS_ENERGY_MJ)[0:3]
    working_mass_balance = working_mass
    energy_balance = ENERGY_BALANCE_MJ
    # Этот цикл сильно замедляет программу. Но пони собирает энергию в полёте, а плотность воздуха падает.
    while energy_balance > WORKING_MASS_ENERGY_MJ:
        drag_force = f_drag_force(total_drag,AIR_DENSITY,speed_metre_second,total_front_square)
        lift_force = f_drag_force(wing_lift_coefficient,AIR_DENSITY,speed_metre_second,WING_SQUARE)
        lift_force_kilogram = lift_force / GRAVITATIONAL_ACCELERATION
        # Расход рабочего вещества за секунду полёта:
        working_mass_consumpion = drag_force / reactive_speed
        working_mass_balance -= working_mass_consumpion
        # Если рабочее вещество кончается, пополняем новым циклом:
        if working_mass_balance < 0:
            working_mass_balance += working_mass
            energy_balance -= WORKING_MASS_ENERGY_MJ
            engine_cycles += 1
        # В ходе полёта пополняем энергию (за счёт всей фронтальной поверхности тела):
        air_volume = total_front_square * aircraft_speed
        energy_collection = air_volume * AIR_MAGIC_ENERGY_MJ
        if namespace.energy is True:
            energy_balance += energy_collection
        # Пройденный путь:
        distance = f_triangle(aircraft_speed, 90 - angle_of_attack, 90)
        path = path + distance
        # Скороподъёмность:
        climb_rate = f_triangle(aircraft_speed, angle_of_attack, 90)
        # Набранная высота:
        altitude = altitude + climb_rate
        if aircraft_mass > lift_force_kilogram:
            #print('Сваливание.')
            break
        second += 1
    # Промежуток между циклами двигателя:
    cycle_period = second / engine_cycles
    flight_output = (
            round(speed_kilometre_hour), round(drag_force), round(lift_force_kilogram),
            second, round(path), round(altitude), engine_cycles, round(cycle_period),
            )
    return flight_output

def f_find_optimum_speed_for_angle (aircraft_mass, angle_of_attack):
    """Взлётная скорость для определённого угла.

    Выведенная из уравнения аэродинамики формула:
    V = sqrt((2 * m * g) / (Cy * p * S))
    Где:
    V - скорость в м/с
    m - масса летательного аппарата в килограммах
    g - ускорение свободного падения (9.81 м/с²)
    Cy - коэффициент подъёмной силы
    p - плотность воздуха в кг/м³ (1.2 при 20°C)
    S - площадь поперечного сечения в м²
    """
    # Надо бы коэффициент подъёмной силы брать на входе скрипта:
    wing_lift_coefficient = d_polar.get(angle_of_attack)[0]
    optimum_speed = math.sqrt((2 * aircraft_mass * GRAVITATIONAL_ACCELERATION) /
            (wing_lift_coefficient * AIR_DENSITY * WING_SQUARE))
    return optimum_speed

def f_find_optimum_speed (max_speed):
    """Оптимальные значения скорости для определённого угла."""
    # Вообще-то это вычисляется простой формулой.
    # Скорость через коэффициент аэродинамического качества:
    # V = sqrt((2 * m * g) / (Cy * p * S))
    # Где:
    # V - скорость в м/с
    # m - масса летательного аппарата в килограммах
    # g - ускорение свободного падения (9.81 м/с²)
    # Cy - коэффициент подъёмной силы
    # p - плотность воздуха в кг/м³ (1.2 при 20°C)
    # S - площадь поперечного сечения в м²

    # А вот эта фигня не нужна:
    speed = 0
    d_test_model = {}
    while speed < max_speed:
        key = speed
        d_test_model[key] = f_flight_model(speed)
        speed += 1
    optimum_speed = max(d_test_model.keys(), key=(lambda k: d_test_model[k][4]))
    #max_distance_output = d_test_model[optimum_speed]
    return optimum_speed

#-------------------------------------------------------------------------
# Встроенный поисковик:

# Создаётся список аргументов скрипта:
parser = create_parser()
namespace = parser.parse_args()

# Проверка, введено ли название летательного аппарата:
if namespace.sample:
    sample = ' '.join(namespace.sample)
else:
    # Если нет, берём стандартный:
    sample = SAMPLE

# Если название неточное, срабатывает встроенный поисковик:
if sample not in d_samples.keys():
    sample = key_search(sample, d_samples, silent=False)
    print('Выбрано:', sample)
    #print(d_samples[sample])

#-------------------------------------------------------------------------
# Рабочие переменные:

# Переменные двигателя:
AIRCRAFT_MASS = d_samples[sample]['Масса аппарата (килограмм)']
AIR_VOLUME = d_samples[sample]['Объём двигателя (кубометров)']
# Переменные аккумулятора:
ENERGY_BALANCE_MJ = d_samples[sample]['Запас энергии (мегаджоулей)']
WORKING_MASS_ENERGY_MJ = d_samples[sample]['Предельная мощность (мегаватт)']
# Переменные планера:
FRONTAL_BODY_DRAG = d_samples[sample]['Коэффициент лобового сопротивления фюзеляжа']
BODY_LENGTH = d_samples[sample]['Длина фюзеляжа (метров)']
BODY_WIDTH = d_samples[sample]['Ширина фюзеляжа (метров)']
BODY_HEIGHT = d_samples[sample]['Высота фюзеляжа (метров)']
WING_WIDTH = d_samples[sample]['Хорда крыла (метров)']
WING_THICKNESS = d_samples[sample]['Толщина крыла (метров)']
WINGSPAN = d_samples[sample]['Размах крыла (метров)']
WHEEL_RADIUS = d_samples[sample]['Радиус колеса шасси (метров)']

# Фронтальная площадь фюзеляжа:
try:
    BODY_FRONT_SQUARE = d_samples[sample]['Фронтальная площадь фюзеляжа (квадратных метров)']
except KeyError:
    # Вычисляется площадь эллипса:
    BODY_FRONT_SQUARE = math.pi * (BODY_WIDTH / 2) * (BODY_HEIGHT / 2)

# Горизонтальная площадь фюзеляжа:
try:
    BODY_BOTTOM_SQUARE = d_samples[sample]['Горизонтальная площадь фюзеляжа (квадратных метров)']
except KeyError:
    BODY_BOTTOM_SQUARE = BODY_LENGTH * BODY_WIDTH

# Фронтальная площадь крыла:
try:
    WING_FRONT_SQUARE = d_samples[sample]['Фронтальная площадь крыла (квадратных метров)']
except KeyError:
    WING_FRONT_SQUARE = WINGSPAN * WING_THICKNESS

# Площадь воздухозаборников:
try:
    AIRFLOW_INTAKES = d_samples[sample]['Площадь воздухозаборников (квадратных метров)']
except KeyError:
    AIRFLOW_INTAKES = WING_FRONT_SQUARE * WING_PERCENT_INTAKES

# Несущая площадь крыла:
try:
    WING_SQUARE = d_samples[sample]['Несущая площадь крыла (квадратных метров)']
except KeyError:
    WING_SQUARE = WINGSPAN * WING_WIDTH

# Нестандартное крыло:
if d_samples[sample]['Дисколёт'] is True:
    DISK_WING = True
else:
    DISK_WING = False

# Словарь соответствий углов атаки и коэффициентов аэродинамики крыла:
try:
    d_polar = d_standard_polar
    d_standard_polar.update(d_samples[sample]['Поляра профиля крыла'])
except KeyError:
    d_polar = d_standard_polar

# Словарь аэродинамического качества для углов атаки:
d_LD_ratio = f_lift_to_drag_ratio(d_polar)

#-------------------------------------------------------------------------
# Обработка аргументов командной строки:

# Проверка, указан ли угол атаки:
if namespace.angle:
    angle_of_attack = f_take_closest(namespace.angle, d_polar.keys())
    fixed_angle = angle_of_attack
    print('Выбрано:', angle_of_attack)
else:
    # Если нет, использовать угол с минимальный лобовым сопротивлением:
    angle_of_attack = min(d_polar.keys(), key=(lambda k: d_polar[k][1]))
    fixed_angle = None

# Проверка, указан ли вес груза:
if namespace.weight:
    aircraft_mass = namespace.weight
else:
    aircraft_mass = AIRCRAFT_MASS

# Проверка, указана ли скорость:
if namespace.speed:
    aircraft_speed = namespace.speed / 3.6
    fixed_speed = namespace.speed / 3.6
else:
    aircraft_speed = 0
    fixed_speed = None

# Проверка, указано ли время:
if namespace.seconds:
    max_seconds = namespace.seconds
else:
    max_seconds = MAX_SECONDS

# Исходные данные для функции полёта:
d_flight = {
        'aircraft_mass':aircraft_mass,
        'aircraft_speed':0,
        'angle_of_attack':angle_of_attack,
        'energy_balance':ENERGY_BALANCE_MJ,
        'engine_air_volume':AIR_VOLUME,
        'climb_speed':0,
        'second':0,
        'path':0,
        'altitude':0,
        }

#-------------------------------------------------------------------------
# Тело программы:

# Проверка, указана ли постоянная скорость:

if namespace.model is True:
    if namespace.speed:
        # Если да, смотрим, насколько она реальна:
        print('Полёт с постоянной скоростью')
        flight_output = f_flight_model(namespace.speed)
        print('Скорость (км/час), лобовое сопротивление (ньютонов), подъёмная сила (кгс)')
        print(flight_output[0:3])
        print('Время, путь, высота, циклы двигателя, между циклами (секунд)')
        print(flight_output[3:8])
    elif namespace.angle is None:
        d_flight_angles = {}
        for key in d_polar:
            if key > 0:
                print('Поиск оптимальной скорости для угла атаки:', key)
                angle_of_attack = key
                d_flight_angles[key] = f_flight_model(f_find_optimum_speed(MAX_SPEED))
        optimum_angle = max(d_flight_angles.keys(), key=(lambda k: d_flight_angles[k][4]))
        optimum_output = d_flight_angles[optimum_angle]
        print('Полёт с оптимальной скоростью и углом атаки:',optimum_angle)
        print('Скорость (км/час), лобовое сопротивление (ньютонов), подъёмная сила (кгс)')
        print(optimum_output[0:3])
        print('Время, путь, высота, циклы двигателя, между циклами (секунд)')
        print(optimum_output[3:8])
    else:
        print('Полёт с оптимальной скоростью')
        flight_output = f_flight_model(f_find_optimum_speed(MAX_SPEED))
        print('Скорость (км/час), лобовое сопротивление (ньютонов), подъёмная сила (кгс)')
        print(flight_output[0:3])
        print('Время, путь, высота, циклы двигателя, между циклами (секунд)')
        print(flight_output[3:8])
else:
    # В ином случае пегас взлетает и пока не кончится энрегия куда-то летит:
    print('Скорость (м/с), путь, высота, мощность (кВт)')
    f_glide_model(d_flight, d_LD_ratio)
